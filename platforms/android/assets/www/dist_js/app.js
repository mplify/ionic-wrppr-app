angular.module("starter",["ionic","LocalStorageModule","ionic.service.core","App.controllers","App.services","ngCordova","ngCordova.plugins.appAvailability","ngCordovaOauth","pascalprecht.translate","templates","ionic-native-transitions"]).run(["$ionicPlatform","BasicAuthorizationService","$http","$log","TwitterService","ExternalLoad","NetworkService","DTMFService",function(e,n,t,o,r,a,i,s){o.debug("run app"),e.ready(function(){o.debug("ionic platform ready"),window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault(),r.checkTwitterApp(),a.checkExternalLoad(),navigator.globalization.getPreferredLanguage(function(e){o.debug("globalization plugin : ",e)},function(e){o.error("globalization plugin error",e)})}),e.on("resume",function(){a.checkExternalLoad()});var l=n.getToken();l&&(o.info("set default credentials"),t.defaults.headers.common.Authorization=l)}]).config(["$stateProvider","$urlRouterProvider","$httpProvider","$ionicConfigProvider","$translateProvider","$logProvider","$compileProvider",function(e,n,t,o,r,a,i){e.state("root",{url:"/root",templateUrl:"dashboard2.html"}).state("login",{url:"/login",templateUrl:"login.html",controller:"AppCtrl"}).state("register",{url:"/register",templateUrl:"register.html",controller:"AuthorizationCtrl"}).state("restorepassword",{url:"/restorepassword",templateUrl:"restore-password.html",controller:"RestorePasswordCtrl"}).state("changepassword",{url:"/changepassword/:key",templateUrl:"change-password.html",controller:"RestorePasswordCtrl"}).state("app",{url:"/app",templateUrl:"menu.html","abstract":!0,controller:"AppCtrl"}).state("app.intro",{url:"/intro",views:{menuContent:{templateUrl:"intro.html"}}}).state("app.dashboard2",{url:"/dashboard2",views:{menuContent:{templateUrl:"dashboard2.html"}}}).state("app.search",{url:"/search",views:{menuContent:{templateUrl:"organization-list.html",controller:"OrganizationsCtrl"}}}).state("app.organizations",{url:"/search",views:{menuContent:{templateUrl:"organization-list.html"}},controller:"OrganizationsCtrl"}).state("app.options",{url:"/options/:orgID/:parentID",views:{menuContent:{templateUrl:"option-list.html"}},controller:"OptionsCtrl"}).state("app.actions",{url:"/actions/:orgName",views:{menuContent:{templateUrl:"actions.html"}},controller:"OptionsCtrl"}).state("app.user",{url:"/user",views:{menuContent:{templateUrl:"user.html"}}}).state("app.messages",{url:"/messages",views:{menuContent:{templateUrl:"message-list.html"}}}).state("app.messagedetails",{url:"/messagedetails/:messageID",views:{menuContent:{templateUrl:"message-details.html"}}}).state("app.favorites",{url:"/favorites",views:{menuContent:{templateUrl:"favorites.html"}}}).state("app.favorite",{url:"/favorite/:orgID",views:{menuContent:{templateUrl:"message-list.html"}}}).state("app.documents",{url:"/documents",views:{menuContent:{templateUrl:"capture-document.html"}}}).state("app.documentdetails",{url:"/documentdetails/:name",params:{document:null},views:{menuContent:{templateUrl:"document-details.html"}}}),n.otherwise("/root"),t.defaults.withCredentials=!0,t.defaults.headers.common["Access-Control-Allow-Headers"]="*",t.defaults.headers.common["Access-Control-Allow-Origin"]="*",o.views.swipeBackEnabled(!0);var s=navigator.language||navigator.userLanguage,l="nl";s.startsWith("en")&&(l="en"),r.useStaticFilesLoader({prefix:"locales/",suffix:".json"}).registerAvailableLanguageKeys(["en","nl"],{en:"en",en_GB:"en",en_US:"en",de:"nl",de_DE:"nl",de_CH:"nl"}).preferredLanguage(l).fallbackLanguage("nl").useSanitizeValueStrategy("escapeParameters"),a.debugEnabled(!0),i.imgSrcSanitizationWhitelist(/^\s*(https?|file|blob|cdvfile|content):|data:image\//)}]),angular.module("templates",[]).run(["$templateCache",function(e){e.put("actions.html",'<ion-view view-title="Contact {{currentOrganization}}" ng-controller="ActionCtrl">\n\n    <ion-content>\n        <div style="height: 5px;" ng-style="{\'background-color\': brandingColor}"></div>\n        <div class="row" style="height: 10%; padding-left: 20px; padding-right: 20px;">\n            <h3 style="text-align: center; width: 100%;">{{currentOrganization}}</h3>\n        </div>\n\n        <div class="row" ng-repeat="option in currentOptions">\n            <p style="text-align: center; width: 100%;">{{option.NodeName}}</p>\n        </div>\n\n        <div class="row button-block" style="text-align: center; display: block;"  ng-show="contacts.call == null && contacts.twitter == null && contacts.email == null">\n\n                <div class="ion-sad-outline" style="font-size: 86px; color: lightgray;"></div>\n            <h4 class="title" style="width: 100%; text-align: center;">We don\'t have any contacts for {{currentOrganization}}, please try later or contact our support</h4>\n\n\n        </div>\n\n        <div class="row" style="height: 40%; padding-left: 20px; padding-right: 20px;">\n            <div class="col" ng-hide="contacts.call == null">\n                <div class="features-box-icon" ng-style="{\'background-color\': brandingColor2}" ng-click="call();">\n                    <span aria-hidden="true" class="icon_phone"></span>\n                    <button class="button button-clear">\n                        CALL\n                    </button>\n                </div>\n\n            </div>\n\n            <div class="col">\n\n            </div>\n\n            <div class="col" ng-hide="contacts.twitter == null">\n                <div class="features-box-icon" ng-style="{\'background-color\': brandingColor2}" ng-click="tweet();">\n                    <span aria-hidden="true" class="social_twitter"></span>\n                    <button class="button button-clear">\n                        TWEET\n                    </button>\n                </div>\n\n            </div>\n\n        </div>\n        <div class="row" style="height: 40%; padding-left: 20px; padding-right: 20px;">\n            <div class="col">\n            </div>\n            <div class="col" ng-hide="contacts.email == null">\n                <div class="features-box-icon" ng-style="{\'background-color\': brandingColor2}" ng-click="mail();">\n                    <span aria-hidden="true" class="icon_mail"></span>\n                    <button class="button button-clear">\n                        MAIL\n                    </button>\n                </div>\n\n            </div>\n            <div class="col">\n            </div>\n        </div>\n\n\n    </ion-content>\n    <div class="bar bar-footer">\n        <div class="button-bar">\n            <button class="button button-clear" ng-click="mailFeedback();">\n                Feedback\n            </button>\n            <button class="button button-clear" ng-click="mailSupport();">\n                Support\n            </button>\n        </div>\n    </div>\n</ion-view>'),e.put("capture-document.html",'<ion-view view-title="Capture Document" ng-controller="DocumentCtrl" ng-init="load()">\n\n    <ion-content>\n\n        <ion-list>\n            <ion-item ng-repeat="image in images" class="item-body" ng-click="selectDocument(image);">\n                <img class="full-image" ng-src="{{urlForImage(image.url)}}" style="height: 300px;">\n                <p>{{image.url}}</p>\n                <p>{{image.name}}</p>\n            </ion-item>\n        </ion-list>\n\n\n\n    </ion-content>\n    <div class="bar bar-footer">\n        <div class="button-bar">\n            <button class="button button-clear" ng-click="addImage();">\n                Add Image\n            </button>\n            <button class="button button-clear" ng-click="load();">\n                Load\n            </button>\n        </div>\n    </div>\n\n\n</ion-view>'),e.put("change-password.html",'<ion-view>\n    <ion-header-bar>\n        <h1 class="title">Change Password</h1>\n        <div class="buttons">\n            <button class="button button-clear" ui-sref="root">Close</button>\n        </div>\n    </ion-header-bar>\n    <ion-content scroll="false">\n        <form name="changePasswordForm" ng-submit="doChangePassword()" novalidate  ng-controller="RestorePasswordCtrl">\n            <div class="list">\n\n                <label class="item item-input">\n                    <span class="input-label">Password</span>\n                    <input type="password" ng-model="newPassword" required>\n\n                </label>\n                <label class="item password-complexity row" ng-show="passwordComplexity">\n                    <div class="col" ng-class="passwordComplexity"></div>\n                </label>\n                <label class="item item-input" ng-show="!changePasswordForm.newPassword.$pristine && changePasswordForm.newPassword.$invalid">\n                    <p ng-show="changePasswordForm.newPassword.$error.required">* Password is required</p>\n                </label>\n                <label class="item item-input">\n                    <span class="input-label">Repeat Password</span>\n                    <input type="password" ng-model="repeatPassword" required>\n                </label>\n                <label class="item item-input" ng-show="!changePasswordForm.repeatPassword.$pristine && !passwordMatch">\n                    <p ng-show="!passwordMatch">* Passwords don\'t match</p>\n                </label>\n\n                <label class="item">\n                    <button class="button button-block button-assertive wrppr-action-button" ng-disabled="changePasswordForm.$invalid || !passwordMatch" type="submit">Change Password</button>\n                </label>\n                <label class="">\n                    <button class="button button-block button-clear">Support</button>\n                </label>\n\n            </div>\n        </form>\n\n\n\n    </ion-content>\n\n\n</ion-view>\n'),e.put("dashboard.html",'<ion-view class="fill">\n    <ion-content>\n        <div class="row" style="height: 40%;"> </div>\n        <div class="row">\n            <h1 style="text-align: center; width: 100%;">Your business contacts</h1>\n\n        </div>\n        <div class="row">\n            <h2 style="text-align: center; width: 100%;">Search any business, choose your question and contact</h2>\n        </div>\n\n\n    </ion-content>\n    <div class="bar bar-footer" style="padding: 0px;">\n        <div class="button-bar">\n            <a class="button button-energized" ui-sref="login">Login</a>\n            <a class="button button-assertive" ui-sref="register">Register</a>\n        </div>\n    </div>\n\n</ion-view>'),e.put("dashboard2.html",'<ion-view class="fill" ng-controller="DashboardCtrl">\n    <ion-content style="margin-left: 20px; margin-right: 20px;">\n        <div class="row" style="height: 20%;"> </div>\n        <div class="row">\n            <h1 style="text-align: center; width: 100%;">{{\'DASHBOARD.TITLE\' | translate}}</h1>\n\n        </div>\n        <div class="row">\n            <h2 style="text-align: center; width: 100%;">{{\'DASHBOARD.DESCRIPTION\' | translate}}</h2>\n        </div>\n        <div class="row" ng-controller="FacebookCtrl" ng-show="facebookLoginEnabled" ng-init="facebookAutoLogin()">\n            <button class="button button-block button-positive" ng-click="facebookManualLogin()">{{\'DASHBOARD.FACEBOOK_LOGIN\' | translate}}</button>\n        </div>\n        <div class="row" ng-controller="TwitterCtrl" ng-show="twitterLoginEnabled">\n            <button class="button button-block button-calm" ng-click="twitterLogin()">{{\'DASHBOARD.TWITTER_LOGIN\' | translate}}</button>\n        </div>\n        <div class="row">\n            <div class="col">\n                <button class="button button-block button-clear" style="color: black;" ui-sref="login">{{\'DASHBOARD.LOGIN\' | translate}}</button>\n            </div>\n            <div class="col">\n                <button class="button button-block button-clear" style="color: black;" ui-sref="register">{{\'DASHBOARD.REGISTER\' | translate}}</button>\n            </div>\n\n        </div>\n\n    </ion-content>\n\n</ion-view>'),e.put("document-details.html",'<div class="modal image-modal transparent" on-swipe-down="closeModal()" ng-controller="DocumentCtrl" ng-init="load()">\n\n            <ion-scroll direction="xy" scrollbar-x="false" scrollbar-y="false"\n                        zooming="true" min-zoom="{{zoomMin}}" style="width: 100%; height: 100%"\n                        >\n\n                <div class="image" style="background-image: url({{urlForImage(document.url)}} )"></div>\n\n            </ion-scroll>\n\n</div>'),e.put("favorites.html",'\n<ion-view view-title="Favorites" ng-controller="MessageCtrl">\n    <ion-content>\n        <ion-refresher\n                pulling-text="Pull to refresh..."\n                on-refresh="loadCompanies();">\n        </ion-refresher>\n        <ion-list ng-init="loadCompanies();">\n            <ion-item ng-repeat="company in companies track by company.OrgID"  ng-click="selectOrganisation(company);">\n                {{company.orgName}}\n                <span class="badge badge-balanced">{{company.count}}</span>\n            </ion-item>\n        </ion-list>\n    </ion-content>\n\n</ion-view>'),e.put("intro.html",'<ion-view view-title="Welcome" ng-controller="IntroCtrl" ng-init="init();">\n\n\n    <ion-content style="margin-left: 20px; margin-right: 20px;">\n\n        <div class="row button-block " style="text-align: center; display: block;">\n            <div class="ion-ios-snowy" style="font-size: 86px; color: lightgray;"></div>\n\n        </div>\n        <div class="row"><h4 class="title" style="width: 100%; text-align: center;">Welcome, {{userName}}</h4></div>\n        <div class="row"><h4 class="title" style="width: 100%; text-align: center;">Now you can search any business, choose your question and contact</h4></div>\n        <div class="row" style="height: 30%"></div>\n        <div class="row">\n\n            <button class="button button-large button-assertive wrppr-action-button" style="width: 100%;" ng-click="hideIntro()">\n                Search companies\n            </button>\n\n        </div>\n\n\n\n    </ion-content>\n\n\n</ion-view>'),e.put("login.html",'<ion-view>\n  <ion-header-bar align-title="left">\n    <h1 class="title">{{\'LOGIN_TITLE\' | translate}}</h1>\n    <div class="buttons">\n      <button class="button button-clear" ui-sref="root">{{\'GENERIC_CLOSE\' | translate}}</button>\n    </div>\n  </ion-header-bar>\n  <ion-content scroll="false" ng-controller="AuthorizationCtrl">\n    <form name="loginForm" ng-submit="doLogin()" novalidate>\n      <div class="list">\n\n        <label class="item item-input">\n          <span class="input-label">{{\'USERNAME\' | translate}}</span>\n          <input type="text" name="username" ng-model="loginData.UserName" required>\n\n        </label>\n        <label class="item item-input" ng-show="!loginForm.username.$pristine && loginForm.username.$invalid">\n            <p ng-show="loginForm.username.$error.required">{{\'USERNAME_REQUIRED_VALIDATOR\' | translate}}</p>\n        </label>\n\n        <label class="item item-input">\n          <span class="input-label">{{\'PASSWORD\' | translate}}</span>\n          <input type="password" name="password" ng-model="loginData.Password" required complex-password>\n        </label>\n        <label class="item item-input" ng-show="!loginForm.password.$pristine && loginForm.password.$invalid">\n              <p ng-show="loginForm.password.$error.required">{{\'PASSWORD_REQUIRED_VALIDATOR\' | translate}}</p>\n        </label>\n        <label class="item">\n          <button class="button button-block button-assertive wrppr-action-button" ng-disabled="loginForm.$invalid" type="submit">{{\'LOGIN_BUTTON\' | translate}}</button>\n        </label>\n        <label class="">\n                <button class="button button-block button-clear" ui-sref="restorepassword">{{\'FORGOT_PASSWORD_BUTTON\' | translate}}</button>\n        </label>\n\n      </div>\n    </form>\n\n\n\n  </ion-content>\n\n\n</ion-view>\n'),e.put("menu.html",'<ion-side-menus enable-menu-with-back-views="false">\n    <ion-side-menu-content>\n        <ion-nav-bar class="bar-stable">\n            <ion-nav-buttons >\n                <button class="button button-icon button-clear ion-navicon" menu-toggle="left">\n                </button>\n            </ion-nav-buttons>\n            <ion-nav-back-button>\n            </ion-nav-back-button>\n        </ion-nav-bar>\n\n        <ion-nav-view name="menuContent"></ion-nav-view>\n    </ion-side-menu-content>\n\n    <ion-side-menu side="left">\n        <ion-header-bar class="bar-stable">\n            <h1 class="title">{{\'APP_TITLE\' | translate}}</h1>\n        </ion-header-bar>\n        <ion-content>\n            <ion-list>\n\n                <ion-item menu-close href="#/app/search">\n                    {{\'MENU.BUSINESS_CONTACT_SEARCH\' | translate}}\n                </ion-item>\n                <ion-item menu-close href="#/app/user">\n                    {{\'MENU.USER_PROFILE\' | translate}}\n                </ion-item>\n                <ion-item menu-close href="#/app/favorites">\n                    {{\'MENU.FAVORITES\' | translate}}\n                </ion-item>\n                <ion-item menu-close href="#/app/messages">\n                    {{\'MENU.HISTORY\' | translate}}\n                </ion-item>\n                <ion-item menu-close href="#/app/documents">\n                    {{\'MENU.ATTACHMENTS\' | translate}}\n                </ion-item>\n                <ion-item menu-close ng-click="logout()">\n                    {{\'MENU.LOGOUT\' | translate}}\n                </ion-item>\n\n            </ion-list>\n        </ion-content>\n    </ion-side-menu>\n</ion-side-menus>\n'),e.put("message-details.html",'<ion-view view-title="Message details" ng-controller="MessageCtrl">\n    <ion-content>\n        <ion-list class="list card">\n            <ion-item ng-switch="currentMessage.ChannelTypeID">\n                <div class="row button-block " style="text-align: center; display: block;">\n                    <div ng-switch-when="1" class="ion-ios-telephone" style="font-size: 86px; color: lightgray;"></div>\n                    <div ng-switch-when="2" class="icon ion-email" style="font-size: 86px; color: lightgray;"></div>\n                    <div ng-switch-when="3" class="ion-social-twitter" style="font-size: 86px; color: lightgray;"></div>\n\n                </div>\n                <h2 style="text-align: center;">{{currentMessage.Question}}</h2>\n                <p style="text-align: center;">Created At: {{currentMessage.createdAt | date:\'MM.dd.yyyy HH:mm\'}}</p>\n            </ion-item>\n\n        </ion-list>\n\n    </ion-content>\n    <div class="bar bar-footer">\n        <div class="button-bar">\n            <button class="button button-clear">\n                Add Photo\n            </button>\n            <button class="button button-clear">\n                Report Incorrect\n            </button>\n        </div>\n    </div>\n\n</ion-view>'),e.put("message-list.html",'\n<ion-view view-title="Messages History" ng-controller="MessageCtrl">\n    <ion-content>\n        <ion-refresher\n                pulling-text="Pull to refresh..."\n                on-refresh="load();">\n        </ion-refresher>\n        <ion-list ng-init="load();">\n            <ion-item ng-repeat="message in messages track by message.id" class="item-icon-left" ng-click="selectMessage(message)">\n                   <div ng-switch="message.ChannelTypeID">\n                        <i ng-switch-when="1" class="icon ion-ios-telephone"></i>\n                        <i ng-switch-when="2" class="icon ion-email"></i>\n                        <i ng-switch-when="3" class="icon ion-social-twitter"></i>\n                    </div>\n                    {{message.Question}}\n                    <span class="item-note">\n                     {{message.createdAt | date:\'MM.dd.yyyy HH:mm\'}}\n                    </span>\n            </ion-item>\n        </ion-list>\n    </ion-content>\n\n</ion-view>'),e.put("option-list.html",'\n<ion-view view-title="{{currentOrganization}}" ng-controller="OptionsCtrl">\n    <ion-content ng-show="showOptions">\n        <div style="height: 5px; background-color: #ff5642;" ng-style="{\'background-color\': brandingColor}"></div>\n        <ion-refresher\n                pulling-text="Pull to refresh..."\n                on-refresh="load();">\n        </ion-refresher>\n        <ion-list ng-init="load();">\n            <ion-item ng-repeat="option in options track by option.id" ng-click="selectOption(option);">\n                {{option.NodeName}}\n            </ion-item>\n        </ion-list>\n    </ion-content>\n\n    <ion-content ng-hide="showOptions">\n        <div ng-include src="\'actions.html\'"></div>\n    </ion-content>\n</ion-view>'),e.put("organization-list.html",'<ion-view view-title="{{ \'BUSINESS_CONTACT.SEARCH\' | translate }}" ng-controller="OrganizationsCtrl" >\n\n    <ion-content ng-show="introVisible">\n        <div class="bar bar-header item-input-inset">\n            <label class="item-input-wrapper">\n                <i class="icon ion-ios-search placeholder-icon"></i>\n                <input type="search" placeholder="{{ \'BUSINESS_CONTACT.SEARCH_FILTER_PLACEHOLDER\' | translate }}" ng-model="search.model">\n                <a ng-if="search.model != \'\'"\n                   on-touch="search.model=\'\'">\n                    <i class="icon ion-ios-close placeholder-icon"></i>\n                </a>\n            </label>\n\n\n        </div>\n        <ion-refresher\n                pulling-text="{{ \'GENERIC.REFRESH\' | translate }}"\n                on-refresh="reload();">\n        </ion-refresher>\n        <ion-list>\n            <ion-item ng-repeat="organisation in organizations track by organisation.id" ng-click="selectOrganisation(organisation);">\n                {{organisation.orgName}}\n            </ion-item>\n        </ion-list>\n        <ion-infinite-scroll\n                ng-if="!noMoreItemsAvailable"\n                on-infinite="loadNext()"\n                distance="10%">\n        </ion-infinite-scroll>\n    </ion-content>\n    <ion-content ng-hide="introVisible">\n        <div ng-include src="\'intro.html\'"></div>\n    </ion-content>\n</ion-view>'),e.put("register.html",'<ion-view>\n    <ion-header-bar>\n        <h1 class="title">Register</h1>\n        <div class="buttons">\n            <button class="button button-clear" ui-sref="root">Close</button>\n        </div>\n    </ion-header-bar>\n    <ion-content scroll="false" ng-controller="AuthorizationCtrl">\n        <form name="registerForm" ng-submit="doRegister()">\n            <div class="list">\n                <label class="item item-input">\n                    <span class="input-label">Username</span>\n                    <input type="text" name="UserName" ng-model="registerData.UserName" ng-change="resetValidators(\'UserName\');" required>\n                </label>\n                <label class="item item-input" ng-show="!registerForm.UserName.$pristine && registerForm.UserName.$invalid">\n                    <p ng-show="registerForm.UserName.$error.required">* Username is required</p>\n                    <p ng-show="registerForm.UserName.$error.unique">* Username is not unique</p>\n                </label>\n                <label class="item item-input">\n                    <span class="input-label">Password</span>\n                    <input type="password" name="Password" ng-model="registerData.Password" ng-change="resetValidators(\'Password\');" ng-minlength="6" ng-maxlength="50" required>\n                </label>\n                <label class="item password-complexity row" ng-show="passwordComplexity">\n                    <div class="col" ng-class="passwordComplexity"></div>\n                </label>\n                <label class="item item-input" ng-show="!registerForm.Password.$pristine && registerForm.Password.$invalid">\n                    <p ng-show="registerForm.Password.$error.minlength">* Password minimal length is 6</p>\n                    <p ng-show="registerForm.Password.$error.maxlength">* Password max length is 50</p>\n                </label>\n\n                <label class="item item-input">\n                    <span class="input-label">Mobile</span>\n                    <input type="tel" pattern="+[0-9]*" ng-model="registerData.mobile">\n                </label>\n                <label class="item item-input">\n                    <span class="input-label">Email</span>\n                    <input type="email" ng-model="registerData.email">\n                </label>\n                <label class="item">\n                    <button class="button button-block button-assertive wrppr-action-button" ng-disabled="registerForm.$invalid" type="submit">Register</button>\n                </label>\n            </div>\n        </form>\n        <div>\n\n        </div>\n    </ion-content>\n</ion-view>\n'),e.put("restore-password.html",'<ion-view>\n  <ion-header-bar>\n    <h1 class="title">Recover password</h1>\n    <div class="buttons">\n      <button class="button button-clear" ui-sref="root">Close</button>\n    </div>\n  </ion-header-bar>\n  <ion-content scroll="false">\n    <form name="restorePasswordForm" ng-submit="doRestorePassword()" novalidate  ng-controller="RestorePasswordCtrl">\n      <div class="list">\n\n        <label class="item item-input">\n          <span class="input-label">Username</span>\n          <input type="text" name="username" ng-model="username" required>\n\n        </label>\n        <label class="item item-input" ng-show="!restorePasswordForm.username.$pristine && restorePasswordForm.username.$invalid">\n            <p ng-show="restorePasswordForm.username.$error.required">* Username is required</p>\n        </label>\n\n\n        <label class="item">\n          <button class="button button-block button-assertive wrppr-action-button" ng-disabled="restorePasswordForm.$invalid" type="submit">Restore</button>\n        </label>\n        <label class="">\n                <button class="button button-block button-clear">Support</button>\n        </label>\n\n      </div>\n    </form>\n\n\n\n  </ion-content>\n\n\n</ion-view>\n'),e.put("tabs.html",'<ion-view>\n    <ion-tabs class="tabs-icon-top tabs-color-active-assertive">\n\n        <ion-tab title="tab1" icon="ion-man" ui-sref="intro.login">\n            <ion-nav-view name="tab-tab1"></ion-nav-view>\n        </ion-tab>\n\n        <ion-tab title="tab2" icon="ion-person-stalker" ui-sref="intro.register">\n            <ion-nav-view name="menuContent"></ion-nav-view>\n        </ion-tab>\n    </ion-tabs>\n</ion-view>'),e.put("user.html",'<ion-view view-title="{{localUser.UserName}}" ng-controller="UserCtrl">\n    <ion-content>\n        <ion-list >\n                <ion-item class="item-avatar">\n                    <img ng-src="{{localUser.picture}}" src="../img/photo.jpg">\n                    <h2>{{user.UserName}}</h2>\n                    <p>{{user.email}}</p>\n                    <p>{{user.createdAt | date:\'medium\' }}</p>\n                    <p>\n                        Basic Auth: {{sessionKey}}\n                    </p>\n                </ion-item>\n                <ion-item class="item-avatar">\n                    <img ng-src="{{localFBUser.picture}}" src="../img/photo.jpg">\n                    <h2>{{localFBUser.name}}</h2>\n                    <h2>{{localFBUser.email}}</h2>\n                    <p>{{localFBUser.authResponse.expiresIn | date:\'medium\' }}</p>\n                    <p>\n                        {{localFBUser.authResponse.accessToken}}\n                    </p>\n                </ion-item>\n                <ion-item ng-show="networkType">\n                    Network Type: {{networkType}} is {{networkStatus}}\n                </ion-item>\n                <ion-item>\n                    <button class="button button-large button-assertive wrppr-action-button" style="width: 100%;" ng-click="switchLanguage()">\n                        Switch to English Version\n                    </button>\n                </ion-item>\n\n\n        </ion-list>\n\n\n    </ion-content>\n</ion-view>')}]),angular.module("App.services",[]);var services=angular.module("App.services");services.factory("Base64",function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(n){var t,o,r,a,i,s="",l="",c="",u=0;do t=n.charCodeAt(u++),o=n.charCodeAt(u++),l=n.charCodeAt(u++),r=t>>2,a=(3&t)<<4|o>>4,i=(15&o)<<2|l>>6,c=63&l,isNaN(o)?i=c=64:isNaN(l)&&(c=64),s=s+e.charAt(r)+e.charAt(a)+e.charAt(i)+e.charAt(c),t=o=l="",r=a=i=c="";while(u<n.length);return s},decode:function(n){var t,o,r,a,i,s="",l="",c="",u=0,d=/[^A-Za-z0-9\+\/\=]/g;d.exec(n)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),n=n.replace(/[^A-Za-z0-9\+\/\=]/g,"");do r=e.indexOf(n.charAt(u++)),a=e.indexOf(n.charAt(u++)),i=e.indexOf(n.charAt(u++)),c=e.indexOf(n.charAt(u++)),t=r<<2|a>>4,o=(15&a)<<4|i>>2,l=(3&i)<<6|c,s+=String.fromCharCode(t),64!=i&&(s+=String.fromCharCode(o)),64!=c&&(s+=String.fromCharCode(l)),t=o=l="",r=a=i=c="";while(u<n.length);return s}}});var services=angular.module("App.services");services.service("APIInterceptor",["$rootScope","$q","LocalDataService",function(e,n,t){var o=this;o.request=function(n){if(e.$broadcast("check-authorization"),!n.headers.authorization){var o=t.getBaseToken();o&&(n.headers.authorization=o)}return n},o.response=function(n){return n.data&&n.data.message&&void 0!==n.data.wrppr_users&&n.data.wrppr_users===!1&&e.$broadcast("unauthorized"),n},o.responseError=function(t){return 401===t.status&&e.$broadcast("unauthorized"),503===t.status&&e.$broadcast("serverdown"),n.reject(t)}}]);var services=angular.module("App.services");services.factory("BasicAuthorizationService",["Base64","$http","$log","LocalDataService",function(e,n,t,o){return{generateToken:function(r,a){t.info("set credentials");var i=e.encode(r+":"+a),s="Basic "+i;o.saveBaseToken(s),n.defaults.headers.common.Authorization=s},setToken:function(e){t.info("update auth token "+e),o.saveBaseToken(e),n.defaults.headers.common.Authorization=e},getToken:function(){return o.getBaseToken()},isAuthorized:function(){var e=o.getBaseToken();return t.info("authorization check: "+e),null!==e&&(n.defaults.headers.common.Authorization=e),null!==e},clearCredentials:function(){document.execCommand("ClearAuthenticationCache"),o.saveBaseToken(""),n.defaults.headers.common.Authorization=""}}}]);var services=angular.module("App.services");services.factory("PasswordComplexity",["$log",function(e){return{check:function(n){if(void 0!==n&&0!==n.length){var t="";void 0===n&&(n="");var o=/[A-Z]/.test(n),r=/[a-z]/.test(n),a=/\d/.test(n),i=/\W/.test(n),s=o+r+a+i;return e.info("test password complexity "+s),t=n.length>=8&&s>=3?"green":n.length>=8&&s>=2?"yellow col-67":"red col-33"}}}}]);var services=angular.module("App.services");services.service("LocalDataService",["localStorageService",function(e){var n={AUTH_TOKEN:"base_token",APP_USER:"wrapper_user",FACEBOOK:"facebook_user",TWITTER_APP_AVAILABLE:"twitter_app",NETWORK_TYPE:"network_type",NETWORK_STATE:"network_state",EXTERNAL_LOAD_URL:"external_load",PHOTO_LIBRARY:"photo_library",INTRO_VISITED:"intro_visited"};return{saveBaseToken:function(t){e.set(n.AUTH_TOKEN,t)},getBaseToken:function(){return e.get(n.AUTH_TOKEN)},saveUser:function(t){e.set(n.APP_USER,JSON.stringify(t))},loadUser:function(){var t=e.get(n.APP_USER);return JSON.parse(t||"{}")},saveFacebookResponse:function(t){e.set(n.FACEBOOK,JSON.stringify(t))},getFacebookResponse:function(){var t=e.get(n.FACEBOOK);return JSON.parse(t||"{}")},setTwitterApp:function(t){e.set(n.TWITTER_APP_AVAILABLE,t)},hasTwitterApp:function(){return e.get(n.TWITTER_APP_AVAILABLE)},setNetworkType:function(t){
e.set(n.NETWORK_TYPE,t)},getNetworkType:function(){return e.get(n.NETWORK_TYPE)},setNetworkState:function(t){e.set(n.NETWORK_STATE,t)},getNetworkState:function(){return e.get(n.NETWORK_STATE)},getExternalURL:function(){return e.get(n.EXTERNAL_LOAD_URL)},clearExternalURL:function(){e.remove(n.EXTERNAL_LOAD_URL)},addPhoto:function(t,o){var r=JSON.parse(e.get(n.PHOTO_LIBRARY)||"[]");r.push({name:t,url:o}),e.set(n.PHOTO_LIBRARY,JSON.stringify(r))},getPhotos:function(){var t=JSON.parse(e.get(n.PHOTO_LIBRARY)||"[]");return t},setIntroScreenVisited:function(t){e.set(n.INTRO_VISITED,t)},getIntroScreenVisited:function(){return e.get(n.INTRO_VISITED)?e.get(n.INTRO_VISITED):!1}}}]);var services=angular.module("App.services");services.service("TwitterService",["$ionicPlatform","$log","LocalDataService",function(e,n,t){return{checkTwitterApp:function(){n.info("check Twitter App availability");var e="twitter://";ionic.Platform.isAndroid()&&(e="com.twitter.android"),window.cordova&&appAvailability.checkBool(e,function(e){n.info("check Twitter App is available: "+e),t.setTwitterApp(e)})}}}]);var services=angular.module("App.services");services.service("UserService",["$http","$q","$log","api",function(e,n,t,o){return{searchByFacebookAccount:function(r){t.info("search user by facebook account: "+r);var a=o.byName("base-url")+o.byName("user-url"),i=n.defer(),s={};return s={where:'{"FacebookAccount": "'+r+'"}'},e.get(a,{params:s}).success(function(e){e.length>1&&t.error("There is a problem, more then 1 user with "+r+" facebookAccount"),i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},searchByEmail:function(r){t.info("search user by email: "+r);var a=o.byName("base-url")+o.byName("user-url"),i=n.defer(),s={};return s={where:'{"Emailaddress": "'+r+'"}'},e.get(a,{params:s}).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},createUser:function(r){t.info("create user"+r);var a=o.byName("base-url")+o.byName("user-url")+o.byName("create"),i=n.defer();return e.post(a,r).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},updateUser:function(r){t.info("update user"+r);var a=o.byName("base-url")+o.byName("user-url")+o.byName("update")+"/"+r.id,i=n.defer(),s={FacebookToken:r.FacebookToken,FacebookAccount:r.FacebookAccount,Emailaddress:r.Emailaddress};return e.put(a,s).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},loadUser:function(r){t.info("load user details: "+r);var a=o.byName("base-url")+o.byName("user-url")+"/"+r,i=n.defer();return e.get(a,{}).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise}}}]);var services=angular.module("App.services");services.service("LoginService",["$http","$q","$log","api",function(e,n,t,o){return{login:function(r){t.info("login");var a=o.byName("base-url")+o.byName("login-url"),i=n.defer();return e.post(a,r).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},restorePassword:function(r){t.info("send restore password email");var a=o.byName("base-url")+o.byName("restore-password-url"),i=n.defer();return e.get(a,{params:{type:"passwordRestore",username:r}}).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},activateUser:function(r){t.info("send activate password email");var a=o.byName("base-url")+o.byName("restore-password-url"),i=n.defer();return e.get(a,{params:{type:"createUser",userID:r}}).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise}}}]);var services=angular.module("App.services");services.service("OrganizationService",["$http","$q","$log","api",function(e,n,t,o){return{getOrganizations:function(r,a){t.info("load organisations: "+r),t.debug(e.defaults.headers.common.Authorization);var i=o.byName("base-url")+o.byName("organization-url"),s=n.defer(),l={};return void 0!==r&&r.length>0&&(l={where:'{"orgName":{"startsWith":"'+r+'"}}'}),a&&(t.info("use last id paging param "+a),l.skip=a),l.limit=30,e.get(i,{params:l}).success(function(e){s.resolve(e)}).error(function(e){s.reject(e)}),s.promise},getOrganization:function(r){t.info("load organisation details: "+r);var a=o.byName("base-url")+o.byName("organization-url")+"/"+r,i=n.defer(),s={};return e.get(a,{params:s}).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise}}}]);var services=angular.module("App.services");services.service("OptionService",["$http","$q","$log","api",function(e,n,t,o){return{getOptions:function(r,a){t.info("load options:  organization"+r+" parent node id"+a);var i=o.byName("base-url")+o.byName("routing-url"),s=n.defer(),l={OrgID:r,ParentNode:a};return e.get(i,{params:l}).success(function(e){s.resolve(e)}).error(function(e){s.reject(e)}),s.promise}}}]);var services=angular.module("App.services");services.service("MessageService",["$http","$q","$log","api",function(e,n,t,o){return{createMessage:function(r){t.info("save message"+r);var a=o.byName("base-url")+o.byName("message-url")+o.byName("create"),i=n.defer();return e.post(a,r).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},loadMessage:function(r){t.info("load message details "+r);var a=o.byName("base-url")+o.byName("message-url")+"/"+r,i=n.defer();return e.get(a).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},getMessagesByUser:function(r,a){t.info("load messages for user: "+r);var i=o.byName("base-url")+o.byName("message-url"),s=n.defer(),l={};return void 0!==r&&(l={UserID:r}),a&&(l.OrgID=a),e.get(i,{params:l}).success(function(e){s.resolve(e)}).error(function(e){s.reject(e)}),s.promise},getCompaniesWithMsgCount:function(r){t.info("load companies with messages count");var a=o.byName("base-url")+o.byName("companies-messages-url"),i=n.defer(),s={};return void 0!==r&&(s={userID:r}),e.get(a,{params:s}).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise}}}]);var services=angular.module("App.services");services.service("DTMFService",["$log","$cordovaContacts",function(e,n){return{createNumber:function(n,t){e.info("convert selected routing to DTMF number");var o=n.TelephoneNumber;if(n.initialpause&&null!==n.initialpause)for(e.info("add initial pause "+n.initialpause),i=0;i<n.initialpause;i++)o+=",";for(var r in t)o=o+","+t[0].DTMFID;return o}}}]);var services=angular.module("App.services");services.service("NetworkService",["$ionicPlatform","$rootScope","$log","$ionicPopup","$cordovaNetwork","LocalDataService",function(e,n,t,o,r,a){e.ready(function(){var e=r.getNetwork(),o=r.isOnline();t.info("network type: "+e),a.setNetworkState(o),a.setNetworkType(e),n.$on("networkOnline",function(e,n){var t=n;a.setNetworkState(t)}),n.$on("networkOffline",function(e,n){a.setNetworkState(n)})},!1)}]);var services=angular.module("App.services");services.service("ExternalLoad",["LocalDataService","$state","$log",function(e,n,t){var o=function(e,n){var t=RegExp("[?&]"+n+"=([^&]*)").exec(e);return t&&decodeURIComponent(t[1].replace(/\+/g," "))};return{checkExternalLoad:function(){var r=e.getExternalURL();if(r&&r.indexOf("changepassword")>-1){t.info("redirect to change password screen");var a=o(r,"key");n.go("changepassword",{key:a}),e.clearExternalURL()}}}}]);var services=angular.module("App.services");services.service("FacebookService",["$q","$log","UserService","LocalDataService",function(e,n,t,o){var r=function(){n.info("facebook login status");var t=e.defer();return facebookConnectPlugin.getLoginStatus(function(e){n.info("facebook login status success : "+e.status),t.resolve(e)},function(e){t.reject(e)}),t.promise},a=function(t){var o=e.defer();return facebookConnectPlugin.api("/me?fields=email,name&access_token="+t,["public_profile"],function(e){o.resolve(e)},function(e){n.error(e),o.reject(e)}),o.promise},i=function(n,o){var r=e.defer();if(angular.isDefined(n.email)){var a=n.email;t.searchByFacebookAccount(a).then(function(e){if(0===e.length)t.searchByEmail(a).then(function(e){if(0===e){var a={UserName:n.email,Emailaddress:n.email,FacebookAccount:n.email,Password:n.email,FacebookToken:o};t.createUser(a).then(function(e){r.resolve(e)},function(e){r.reject(e)})}else{var i=e[0];i.FacebookToken=o,t.updateUser(i).then(function(e){r.resolve(e)},function(e){r.reject(e)})}},function(e){r.reject(e)});else{var i=e[0];i.FacebookToken=o,t.updateUser(i).then(function(e){r.resolve(e)},function(e){r.reject(e)})}},function(e){r.reject(e)})}else r.reject();return r.promise};return{getLoginStatus:r,getProfileInfo:a,saveUser:i}}]);var services=angular.module("App.services");services.service("DocumentService",["$cordovaCamera","$cordovaFile","LocalDataService","$log","$q",function(e,n,t,o,r){var a="documents";return{createFolder:function(){var e=r.defer();return n.checkDir(cordova.file.dataDirectory,a).then(function(n){o.debug("directory exists"),e.resolve(n)},function(t){o.error("failed to check folder exists",t),t.code&&1==t.code?n.createDir(cordova.file.dataDirectory,a).then(function(n){o.debug("directory created"),e.resolve(n)},function(n){o.error("failed to create folder exists",n),e.reject(n)}):e.reject(t)}),e.promise},capturePicture:function(){var i=r.defer(),s={quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA,encodingType:Camera.EncodingType.JPEG,cameraDirection:1,saveToPhotoAlbum:!1};return e.getPicture(s).then(function(e){var r=e.replace(/^.*[\\\/]/,""),s=new Date,l=s.getTime(),c=l+".jpg",u=cordova.file.dataDirectory+a,d=e.substring(0,e.lastIndexOf("/"));n.moveFile(d,r,u,c).then(function(e){var n=e.nativeURL;t.addPhoto(c,e.nativeURL),o.debug("moved file from temp location to ",n),i.resolve(n)},function(e){o.error("failed to move file from temp location",JSON.stringify(e)),i.reject(e)})},function(e){o.error("failed to capture image",e),i.reject(e)}),i.promise}}}]);var App=angular.module("App.services");App.constant("API",{"proxy-url":"/api","base-url":"https://wrppr-core.herokuapp.com","login-url":"/login","logout-url":"/logout","restore-password-url":"/wrppr_pwRestoreEmail","organization-url":"/wrppr_organizations","routing-url":"/wrppr_routing","user-url":"/wrppr_users","message-url":"/wrppr_messages","companies-messages-url":"/wrppr_numMessPerOrg",create:"/create",update:"/update"}),App.factory("api",["API",function(e){return{byName:function(n){return window.cordova||"base-url"!=n||(n="proxy-url"),e[n]}}}]),angular.module("App.controllers",[]).controller("AppCtrl",["$scope","$rootScope","$state","$log","$ionicPlatform","$ionicModal","$ionicPopup","$ionicLoading","$ionicHistory","$timeout","$q","BasicAuthorizationService","UserService","$cordovaOauth","api","$http","LocalDataService",function(e,n,t,o,r,a,i,s,l,c,u,d,p,g,m,v,f){n.sessionData={},e.$on("$ionicView.beforeEnter",function(){n.sessionData.organization&&(null!==n.sessionData.organization.BrandingColor1?n.brandingColor=n.sessionData.organization.BrandingColor1:n.brandingColor="#ff5642",null!==n.sessionData.organization.BrandingColor2?n.brandingColor2=n.sessionData.organization.BrandingColor2:n.brandingColor2="#ff5642")}),e.logout=function(){d.clearCredentials(),window.cordova&&facebookConnectPlugin.logout(),f.saveUser({});var e=m.byName("base-url")+m.byName("logout-url");v.get(e,{}).success(function(e){o.debug("logout done")}).error(function(e){}),t.go("root")},e.$on("serverdown",function(){i.alert({title:"Service is temporarily not available",template:"BUT we are working hard to fix it"})}),e.$on("unauthorized",function(){o.info("unauthorized, redirect to root"),t.current.name.indexOf("app")>-1&&t.go("root")})}]);var controllers=angular.module("App.controllers");controllers.controller("AuthorizationCtrl",["$scope","$ionicLoading","$ionicModal","$ionicPopup","$state","$log","$stateParams","LoginService","BasicAuthorizationService","UserService","PasswordComplexity","LocalDataService",function(e,n,t,o,r,a,i,s,l,c,u,d){a.info("init auth controller"),e.registerData={},e.loginData={},e.passwordComplexity="",e.loginSubmitted=!1,e.doLogin=function(){a.info("Doing login",e.loginData),n.show({template:"Loading..."}),s.login(e.loginData).then(function(t){if(n.hide(),e.$broadcast("scroll.refreshComplete"),t.wrppr_users===!1)return a.error("login failed: "+t.message),void o.alert({title:"Login failed",template:t.message});var i=t.wrppr_users;d.saveUser(i),d.saveFacebookResponse({}),l.generateToken(e.loginData.UserName,e.loginData.Password),e.resetLoginForm(),r.go("app.search")},function(e){n.hide(),a.error("failed to login",e),o.alert({title:"Login failed",template:e})})},e.resetLoginForm=function(){e.loginData.UserName="",e.loginData.Password="",e.loginForm.$setPristine(),e.loginForm.$setUntouched()},e.doRegister=function(){n.show({template:"Loading..."}),a.info("start registration"),c.createUser(e.registerData).then(function(t){l.generateToken(e.loginData.UserName,e.loginData.Password);var o=t;d.saveUser(o),n.hide(),e.$broadcast("scroll.refreshComplete"),e.resetRegisterForm(),r.go("app.search")},function(t){if(n.hide(),"E_VALIDATION"===t.error)for(var r in t.invalidAttributes){var a=r.replace(/"/g,""),i=t.invalidAttributes[r];for(var s in i)e.registerForm[a].$setValidity(i[s].rule,!1)}o.alert({title:"Registration Failed",template:t.message})})},e.resetRegisterForm=function(){e.registerData={},e.registerForm.$setPristine(),e.registerForm.$setUntouched()},e.resetValidators=function(n){e.registerForm[n].$setValidity("unique",!0),e.registerForm[n].$setValidity("minLength",!0)},e.$watch("registerData.Password",function(n){var t=u.check(n);e.passwordComplexity=t})}]);var controllers=angular.module("App.controllers");controllers.controller("RestorePasswordCtrl",["$scope","$state","$stateParams","$log","$ionicLoading","$ionicPopup","LoginService","PasswordComplexity",function(e,n,t,o,r,a,i,s){o.info("init restore password controller"),e.username="",e.passwordMatch=!0,e.doRestorePassword=function(){r.show({template:"Sends email ..."}),i.restorePassword(e.username).then(function(){r.hide(),a.alert({title:"Restore Password",template:"Please checkout you  email for instructions"}),n.go("root")},function(){r.hide(),a.alert({title:"Failed to restore",template:"Please try again"})})},e.$watch("newPassword",function(n){var t=s.check(n);e.passwordComplexity=t}),e.$watch("repeatPassword",function(n){void 0!==n&&(n&&e.newPassword===n?e.passwordMatch=!0:e.passwordMatch=!1,o.info("password match "+e.passwordMatch))}),e.doChangePassword=function(){o.info("change password"),alert(t.key)}}]);var controllers=angular.module("App.controllers");controllers.controller("DashboardCtrl",["$scope","$log","LocalDataService",function(e,n,t){n.info("init dashboard controller")}]);var controllers=angular.module("App.controllers");controllers.controller("OrganizationsCtrl",["$scope","$rootScope","$ionicLoading","$state","$log","OrganizationService","LocalDataService",function(e,n,t,o,r,a,i){e.introVisible=i.getIntroScreenVisited(),e.hideIntro=function(){i.setIntroScreenVisited(!0),e.introVisible=!0},e.organizations=[],e.noMoreItemsAvailable=!1,e.isLoading=!1,e.search={model:""},e.load=function(n){r.info("load organizations "+n),t.show({template:"Loading..."}),e.isLoading=!0,a.getOrganizations(n,e.organizations.length).then(function(n){0===n.length&&(e.noMoreItemsAvailable=!0),e.organizations=e.organizations.concat(n),t.hide(),e.isLoading=!1,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")})},e.loadNext=function(){r.debug("load organizations next page"),e.load(e.search.model)},e.reload=function(n){r.debug("reload organization list"),e.organizations=[],e.noMoreItemsAvailable=!1,e.load(n)},e.selectOrganisation=function(e){n.sessionData.organization=e,n.sessionData.options=[],r.info("organisation selected "+e.orgName),o.go("app.options",{orgID:e.id,parentID:0})},e.$watch("search.model",function(n,t){return e.isLoading?void r.debug("skipped loading organization, prev is not done"):(r.info("search organization model changed"),void e.reload(n))})}]);var controllers=angular.module("App.controllers");controllers.controller("OptionsCtrl",["$scope","$rootScope","$state","$stateParams","$log","$ionicLoading","$ionicHistory","OptionService",function(e,n,t,o,r,a,i,s){r.debug("init options controller",n.sessionData.options),e.showOptions=!0,n.$ionicGoBack=function(){t.is("app.options")&&n.sessionData.options.pop(),i.goBack()},e.options=[],e.load=function(){a.show({template:"Loading...",delay:500}),s.getOptions(o.orgID,o.parentID).then(function(n){e.options=n,a.hide(),e.$broadcast("scroll.refreshComplete"),0===e.options.length?e.showOptions=!1:e.showOptions=!0})},e.currentOrganization=o.orgName,e.selectOption=function(e){r.info("selected option "+e),n.sessionData.options.push(e),t.go("app.options",{orgID:o.orgID,parentID:e.NodeID})}}]);var controllers=angular.module("App.controllers");controllers.controller("ActionCtrl",["$scope","$rootScope","$state","$stateParams","$window","$ionicPlatform","$log","$translate","$ionicLoading","LocalDataService","MessageService","UserService","DTMFService","$cordovaContacts",function(e,n,t,o,r,a,i,s,l,c,u,d,p,g){i.debug("init action controller"),n.sessionData.organization||(i.info("organization not selected, redirects to organization search"),t.go("app.organizations")),e.actionMessages={CALL:{type:1,message:"Called "},MAIL:{type:2,message:"Send email to"},TWEET:{type:3,message:"Send tweet to"},FACEBOOK:{type:4,message:"Send a facebook msg"}},e.contacts={},void 0!==n.sessionData.organization&&(e.currentOrganization=n.sessionData.organization.orgName,e.currentOptions=n.sessionData.options,e.contacts.email=n.sessionData.organization.EmailAddress,e.contacts.twitter=n.sessionData.organization.TwitterAccount,e.contacts.call=n.sessionData.organization.TelephoneNumber),e.call=function(){i.info("make a call");var t={filter:"wrapper",multiple:!0,fields:["displayName","name"],desiredFields:["id"]},o=p.createNumber(n.sessionData.organization,e.currentOptions);window.cordova?(l.show({template:"Calling ..."}),g.find(t).then(function(t){var r=new ContactField(n.sessionData.organization.orgName,o,!1);if(t&&t.length>0){var a=t[0];null===a.phoneNumbers&&(a.phoneNumbers=[]),a.phoneNumbers.push(r),a.save(function(){i.info("saved wrapper contact number"),e.makeCall(o),l.hide()},function(e){i.error("failed to save wrapper contact",e),l.hide()})}else{var s={displayName:"wrapper",phoneNumbers:[r]};g.save(s).then(function(n){i.info("added wrapper contact number"),e.makeCall(o),l.hide()},function(n){i.error("failed to save wrapper contact",err),l.hide(),e.makeCallViaURL(o)})}},function(n){i.error("failed to find wrapper contact",n),l.hide(),e.makeCallViaURL(o)})):e.makeCallViaURL(o),e.logAction(e.actionMessages.CALL)},e.makeCall=function(n){window.plugins.CallNumber.callNumber(function(){i.info("finish call")},function(){i.info("failed call"),e.makeCallViaURL(n)},n,!1)},e.makeCallViaURL=function(e){r.location="tel:"+e},e.mail=function(){i.info("send an email"),e.logAction(e.actionMessages.MAIL);var t=s.instant("MAIL.BODY",{company:n.sessionData.organization.orgName});r.location="mailto:"+e.contacts.email+"?subject="+s.instant("MAIL.SUBJECT")+"&body="+t},e.hasTwitterApp=!1,e.tweet=function(){i.info("tweet"),e.logAction(e.actionMessages.TWEET);var n=c.hasTwitterApp();n?window.open("twitter://user?screen_name="+e.contacts.twitter,"_system","location=no"):window.open("https://twitter.com/intent/tweet?screen_name="+e.contacts.twitter,"_system","location=no")},e.logAction=function(t){var o={OrgID:n.sessionData.organization.id,UserID:c.loadUser().id,Question:t.message+' "'+e.currentOrganization+'"',ChannelTypeID:t.type};if(n.sessionData.options.length>0){var r=n.sessionData.options[n.sessionData.options.length-1];i.debug("try to "+t+" for menu: ",r),o.ChoiceMenuID=r.id}u.createMessage(o)},e.mailFeedback=function(){r.location="mailto:feedback@mplify.nl?subject=Feedback about wrapper app"},e.mailSupport=function(){r.location="mailto:support@mplify.nl?subject=Feedback about wrapper app"}}]);var controllers=angular.module("App.controllers");controllers.controller("UserCtrl",["$scope","$rootScope","$log","$translate","$ionicLoading","UserService","LocalDataService",function(e,n,t,o,r,a,i){e.loadUserDetails=function(n){a.loadUser(n).then(function(n){e.user=n},function(e){t.error("failed to load user details")})},e.load=function(){t.info("load user details from local storage"),e.localUser=i.loadUser(),e.localFBUser=i.getFacebookResponse(),e.sessionKey=i.getBaseToken(),e.networkStatus=i.getNetworkState(),e.networkType=i.getNetworkType(),e.localUser.id&&e.loadUserDetails(e.localUser.id)},e.load(),e.$on("$ionicView.enter",function(){e.load()}),e.switchLanguage=function(){o.use("en"),r.show({template:"Switching language ..."}),o.refresh()},n.$on("$translateRefreshEnd",function(){r.hide()})}]);var controllers=angular.module("App.controllers");controllers.controller("FacebookCtrl",["$scope","$rootScope","$state","$stateParams","$ionicPlatform","$q","$log","$ionicLoading","$http","$cordovaOauth","UserService","BasicAuthorizationService","LocalDataService","FacebookService",function(e,n,t,o,r,a,i,s,l,c,u,d,p,g){e.facebookLoginEnabled=window.cordova,e.facebookManualLogin=function(){s.show({template:"Logging in..."}),g.getLoginStatus().then(function(n){if("connected"===n.status){var t=n.authResponse.accessToken;g.getProfileInfo(t).then(function(n){g.saveUser(n,t).then(function(o){e.updateLocalStorage(o,n,t),s.hide()},function(e){i.error("failed to save profile info"),s.hide()})},function(e){i.error("failed to get profile info"),s.hide()})}else e.openNativeLogin()},function(e){})},e.nativeLoginSuccess=function(n){var t=n.authResponse.accessToken;g.getProfileInfo(t).then(function(n){g.saveUser(n,t).then(function(o){e.updateLocalStorage(o,n,t),s.hide()},function(e){i.error("failed to save user"),s.hide()})},function(e){i.error("failed to get profile info"),s.hide()})},e.nativeLoginError=function(e){s.hide()},e.openNativeLogin=function(){facebookConnectPlugin.login(["email","public_profile"],e.nativeLoginSuccess,e.nativeLoginError)},e.updateLocalStorage=function(e,n,o){p.saveUser(e),n.accessToken=o,n.picture="http://graph.facebook.com/"+n.userID+"/picture?type=large",p.saveFacebookResponse(n),i.info("logged in via facebook",e);var r=e.Emailaddress,a="facebook "+o;d.generateToken(r,a),t.go("app.search")}}]);var controllers=angular.module("App.controllers");controllers.controller("TwitterCtrl",["$scope","$rootScope","$state","$stateParams","$ionicLoading","$ionicPlatform","$log","$cordovaOauth","localStorageService","UserService","LocalDataService",function(e,n,t,o,r,a,i,s,l,c,u){e.twitterLoginEnabled=window.cordova,e.consumerKey="JVj33eTXGPxlVZxoT8htdqwNK",e.consumerSecret="Q6K9GtYCrxhLPLWfIkr5eTHvpizf4NbEm6sHhkE0pSo0Ts7TFl",e.twitterProfileInfo={},e.loadTwitterUser=function(){e.twitterProfileInfo=c.getUser()},e.twitterLogin=function(){r.show({template:"Logging in..."}),s.twitter(e.consumerKey,e.consumerSecret,{}).then(function(e){i.info("logged in via twitter",e),r.hide(),t.go("app.search")},function(e){i.error("failed to login via twitter",e),r.hide()})}}]);var controllers=angular.module("App.controllers");controllers.controller("IntroCtrl",["$scope","$state","LocalDataService",function(e,n,t){e.$on("$ionicView.beforeEnter",function(){t.getIntroScreenVisited()&&n.go("app.search")}),e.$on("$ionicView.beforeLeave",function(){t.setIntroScreenVisited(!0)}),e.init=function(){var n=t.loadUser();e.userName=n.UserName}}]);var controllers=angular.module("App.controllers");controllers.controller("MessageCtrl",["$scope","$rootScope","$state","$log","$stateParams","$ionicLoading","$ionicHistory","MessageService","LocalDataService",function(e,n,t,o,r,a,i,s,l){o.info("init messages controller"),e.$on("$ionicView.enter",function(){r.messageID?e.loadMessage():e.load()}),e.messages=[],e.companies=[],e.userID=l.loadUser().id,e.load=function(){a.show({template:"Loading..."});var n=r.orgID;s.getMessagesByUser(e.userID,n).then(function(n){e.messages=n,a.hide(),e.$broadcast("scroll.refreshComplete")})},e.loadCompanies=function(){a.show({template:"Loading..."}),s.getCompaniesWithMsgCount(e.userID).then(function(n){e.companies=n,a.hide(),e.$broadcast("scroll.refreshComplete")},function(n){a.hide(),e.$broadcast("scroll.refreshComplete")})},e.selectOrganisation=function(e){t.go("app.favorite",{orgID:e.OrgID})},e.selectMessage=function(e){t.go("app.messagedetails",{messageID:e.id})},e.currentMessage={},e.loadMessage=function(){a.show({template:"Loading..."});var n=r.messageID;s.loadMessage(n).then(function(n){a.hide(),o.info("loaded message",n),e.currentMessage=n},function(e){a.hide(),o.error("failed to load message ",e)})}}]);var controllers=angular.module("App.controllers");controllers.controller("DocumentCtrl",["$scope","$stateParams","$state","$log","$templateCache","$ionicBackdrop","$ionicModal","$cordovaCamera","$cordovaFile","$ionicLoading","$ionicPopup","LocalDataService","DocumentService",function(e,n,t,o,r,a,i,s,l,c,u,d,p){o.debug("init document controller"),e.images=d.getPhotos(),e.$on("$ionicView.enter",function(){n.document&&e.loadDocument()}),e.load=function(){o.debug("load documents"),p.createFolder().then(function(n){e.images=d.getPhotos()},function(e){})},e.urlForImage=function(e){var n=e.substr(e.lastIndexOf("/")+1);cordova.file.dataDirectory+n;return e},e.addImage=function(){c.show({template:"Capturing image..."}),p.capturePicture().then(function(n){e.images=d.getPhotos(),c.hide(),u.alert({title:"Picture saved",template:n})},function(e){c.hide()})},e.selectDocument=function(n){e.document=n,e.showModal("document-details.html")},e.showModal=function(n){e.modal=i.fromTemplate(r.get(n),{scope:e}),e.modal.show()},e.closeModal=function(){e.modal.hide(),e.modal.remove()}}]);