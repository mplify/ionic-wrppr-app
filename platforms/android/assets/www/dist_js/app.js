angular.module("underscore",[]).factory("_",function(){return window._}),angular.module("starter",["ionic","LocalStorageModule","ionic.service.core","App.controllers","App.services","App.directives","underscore","ngCordova","ngCordova.plugins.appAvailability","ngCordovaOauth","pascalprecht.translate","templates","ionic-native-transitions"]).run(["$ionicPlatform","BasicAuthorizationService","$http","$log","LocalDataService","TwitterService","ExternalLoad","NetworkService","DTMFService","EmailService","FacebookService","LoginService","DocumentService",function(e,n,t,o,a,i,r,s,l,c,u,d,p){d.autoLogin().then(function(e){if(e.wrppr_users){var n=e.wrppr_users;a.saveUser(n)}},function(e){}),o.debug("run app"),e.ready(function(){o.debug("ionic platform ready"),window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault(),i.checkTwitterApp(),r.checkExternalLoad(),s.checkNetworkState(),u.autoLogin(),p.createFolder()}),e.on("resume",function(){r.checkExternalLoad(),s.checkNetworkState()});var g=n.getToken();g&&(o.info("set default credentials"),t.defaults.headers.common.Authorization=g)}]).config(["$stateProvider","$urlRouterProvider","$httpProvider","$ionicConfigProvider","$translateProvider","$logProvider","$compileProvider",function(e,n,t,o,a,i,r){e.state("auth",{url:"/auth",templateUrl:"auth/auth.html","abstract":!1}).state("auth.login",{url:"/login",templateUrl:"auth/login.html",controller:"AppCtrl"}).state("auth.walkthrough",{url:"/walkthrough",templateUrl:"auth/walkthrough.html"}).state("auth.signup",{url:"/signup",templateUrl:"auth/signup.html"}).state("auth.restorepassword",{url:"/restorepassword",templateUrl:"auth/restore-password.html",controller:"RestorePasswordCtrl"}).state("auth.changepassword",{url:"/changepassword/:key",templateUrl:"auth/change-password.html",controller:"RestorePasswordCtrl"}).state("offline",{url:"/offline",templateUrl:"no-internet.html",controller:"AppCtrl"}).state("app",{url:"/app",templateUrl:"menu.html","abstract":!0,controller:"AppCtrl"}).state("app.intro",{url:"/intro",views:{menuContent:{templateUrl:"intro.html"}}}).state("app.search",{url:"/search",views:{menuContent:{templateUrl:"organization-list.html",controller:"OrganizationsCtrl"}}}).state("app.organizations",{url:"/search",views:{menuContent:{templateUrl:"organization-list.html"}},controller:"OrganizationsCtrl"}).state("app.options",{url:"/options/:orgID/:parentID",views:{menuContent:{templateUrl:"option-list.html"}},controller:"OptionsCtrl"}).state("app.actions",{url:"/actions/:orgName",views:{menuContent:{templateUrl:"actions.html"}},controller:"OptionsCtrl"}).state("app.user",{url:"/user",views:{menuContent:{templateUrl:"user.html"}}}).state("app.messages",{url:"/messages",views:{menuContent:{templateUrl:"message-list.html"}}}).state("app.messagedetails",{url:"/messagedetails/:messageID",views:{menuContent:{templateUrl:"message-details.html"}}}).state("app.favorites",{url:"/favorites",views:{menuContent:{templateUrl:"favorites.html"}}}).state("app.favorite",{url:"/favorite/:orgID",views:{menuContent:{templateUrl:"message-list.html"}}}).state("app.documents",{url:"/documents",views:{menuContent:{templateUrl:"capture-document.html"}}}).state("app.documentdetails",{url:"/documentdetails/:name",params:{document:null},views:{menuContent:{templateUrl:"document-details.html"}}}),n.otherwise("/auth/walkthrough"),t.interceptors.push("APIInterceptor"),t.defaults.withCredentials=!0,t.defaults.headers.common["Access-Control-Allow-Headers"]="*",t.defaults.headers.common["Access-Control-Allow-Origin"]="*",o.views.swipeBackEnabled(!0);var s=navigator.language||navigator.userLanguage,l="nl";s&&s.indexOf("en")>-1&&(l="en"),a.useStaticFilesLoader({prefix:"locales/",suffix:".json"}).registerAvailableLanguageKeys(["en","nl"],{en:"en",en_GB:"en",en_US:"en",de:"nl",de_DE:"nl",de_CH:"nl"}).preferredLanguage(l).fallbackLanguage("nl").useSanitizeValueStrategy("escapeParameters"),i.debugEnabled(!0),r.imgSrcSanitizationWhitelist(/^\s*(https?|file|blob|cdvfile|content):|data:image\//)}]),angular.module("templates",[]).run(["$templateCache",function(e){e.put("actions.html",'<ion-view view-title="{{\'ACTIONS.TITLE\' | translate}} {{currentOrganization}}" ng-controller="ActionCtrl">\n\n    <ion-content ng-init="init();">\n        <div style="height: 5px;" ng-style="{\'background-color\': brandingColor}"></div>\n        <div class="row" style="height: 10%; padding-left: 20px; padding-right: 20px;">\n            <h3 style="text-align: center; width: 100%;">{{currentOrganization}}</h3>\n        </div>\n\n        <div class="row" ng-repeat="option in currentOptions">\n            <p style="text-align: center; width: 100%;">{{option.NodeName}}</p>\n        </div>\n\n        <div class="row button-block" style="text-align: center; display: block;"\n             ng-show="contacts.call == null && contacts.twitter == null && contacts.email == null">\n\n            <div class="ion-sad-outline" style="font-size: 86px; color: lightgray;"></div>\n            <h4 class="title" style="width: 100%; text-align: center;">{{\'ACTIONS.NO_CONTACTS_TITLE\' | translate}}\n                {{currentOrganization}}{{\'ACTIONS.NO_CONTACTS_MSG\' | translate}}</h4>\n\n\n        </div>\n\n        <div class="row" style="height: 40%; padding-left: 20px; padding-right: 20px;">\n            <div class="col" ng-hide="contacts.call == null">\n                <div class="features-box-icon" ng-style="{\'background-color\': brandingColor2}" ng-click="call();">\n                    <span aria-hidden="true" class="ion-ios-telephone"></span>\n                    <button class="button button-clear">\n\n                    </button>\n                </div>\n\n            </div>\n\n            <div class="col" ng-hide="contacts.twitter == null">\n                <div class="features-box-icon" ng-style="{\'background-color\': brandingColor2}" ng-click="tweet();">\n                    <span aria-hidden="true" class="ion-social-twitter"></span>\n                    <button class="button button-clear">\n\n                    </button>\n                </div>\n\n            </div>\n\n        </div>\n        <div class="row" style="height: 40%; padding-left: 20px; padding-right: 20px;">\n\n            <div class="col" ng-hide="contacts.email == null">\n                <div class="features-box-icon" ng-style="{\'background-color\': brandingColor2}" ng-click="mail();">\n                    <span aria-hidden="true" class="ion-email"></span>\n                    <button class="button button-clear">\n\n                    </button>\n                </div>\n\n            </div>\n            <div class="col" ng-show="hasWebpage">\n                <div class="features-box-icon" ng-style="{\'background-color\': brandingColor2}" ng-click="webpage();">\n                    <span aria-hidden="true" class="ion-android-globe"></span>\n                    <button class="button button-clear">\n\n                    </button>\n                </div>\n\n            </div>\n        </div>\n\n    </ion-content>\n    <div class="tabs tabs-icon-top">\n        <a class="tab-item" ng-click="mailFeedback();">\n            <i class="icon ion-speakerphone"></i>\n            {{ \'GENERIC.FEEDBACK\' | translate }}\n        </a>\n        <a class="tab-item" ng-show="supportMessage.id">\n            <i class="icon ion-edit" ng-click="showUserCorrect();"></i>\n            {{ \'USER_CORRECT.BUTTON\' | translate }}\n        </a>\n\n    </div>\n\n\n</ion-view>'),e.put("capture-document.html",'<ion-view view-title="{{\'ATTACHMENT.TITLE\' | translate}}" ng-controller="DocumentCtrl" ng-init="load()">\n\n    <ion-content>\n\n        <ion-list>\n            <ion-item ng-repeat="image in images track by image.name" class="item item-image" style="padding: 10px;" ng-click="selectDocument(image);">\n                <p>{{image.name | Filename}}</p>\n                <img class="full-image" ng-src="{{urlForImage(image.url)}}" style="height: 300px;">\n\n\n            </ion-item>\n        </ion-list>\n    </ion-content>\n    <div class="bar bar-footer" ng-show="cameraAvailable">\n        <div class="button-bar">\n            <button class="button button-clear" ng-click="addImage();">\n                {{\'ATTACHMENT.ADD\' | translate}}\n            </button>\n            <button id="attachmentsReload" class="button button-clear" ng-click="load();">\n                {{\'ATTACHMENT.RELOAD\' | translate}}\n            </button>\n        </div>\n    </div>\n\n\n</ion-view>'),e.put("document-details.html",'<div class="modal image-modal transparent" on-swipe-down="closeModal()" ng-controller="DocumentCtrl">\n\n            <ion-scroll direction="xy" scrollbar-x="false" scrollbar-y="false"\n                        zooming="true" min-zoom="{{zoomMin}}" style="width: 100%; height: 100%"\n                        >\n\n                <div class="image" style="background-image: url({{urlForImage(document.url)}} )"></div>\n\n            </ion-scroll>\n\n</div>'),e.put("favorites.html",'\n<ion-view class="bookmarks-view" ng-controller="FavoritesCtrl">\n    <ion-nav-title>\n        <span>{{\'FAVORITES.TITLE\' | translate}}</span>\n    </ion-nav-title>\n    <ion-content>\n        <div ng-if="organizations.length === 0" class="row bookmarks-container">\n            <div class="col col-center">\n                <div class="empty-results">\n                    <i class="icon ion-bookmark"></i>\n                    <h3 class="no-bookmarks">{{"FAVORITES.EMPTY_MSG" | translate}}</h3>\n                </div>\n            </div>\n        </div>\n\n            <ion-list ng-if="organizations.length > 0">\n                <ion-item ng-repeat="org in organizations track by org.OrgID"  ng-click="selectOrganisation(org);">\n                    {{org.orgName}}\n                    <span class="badge wrppr-action-button" style="color: white;">{{org.count}}</span>\n                </ion-item>\n            </ion-list>\n\n    </ion-content>\n</ion-view>'),e.put("intro.html",'<ion-modal-view>\n    <ion-header-bar align-title="left">\n        <h1 class="title">{{\'INTRO.TITLE\' | translate}}</h1>\n        <div class="buttons">\n            <button class="button button-clear" ng-click="hideIntro();">{{\'GENERIC_CLOSE\' | translate}}</button>\n        </div>\n    </ion-header-bar>\n\n\n\n    <ion-content style="margin-left: 20px; margin-right: 20px;">\n\n        <div class="row button-block " style="text-align: center; display: block;">\n            <div class="ion-coffee" style="font-size: 86px; color: lightgray;"></div>\n\n        </div>\n        <div class="row"><h4 class="title" style="width: 100%; text-align: center;">{{\'INTRO.TEXT\' | translate}}{{userName}}</h4></div>\n        <div class="row"><h4 class="title" style="width: 100%; text-align: center;">{{\'INTRO.DESCRIPTION\' | translate}}</h4></div>\n        <div class="row" style="height: 30%"></div>\n        <div class="row">\n\n            <button class="button button-large button-assertive wrppr-action-button" style="width: 100%;" ng-click="hideIntro()">\n                {{\'INTRO.SEARCH_BUTTON\' | translate}}\n            </button>\n\n        </div>\n\n\n\n    </ion-content>\n\n\n</ion-modal-view>'),e.put("menu.html",'\n<ion-side-menus enable-menu-with-back-views="false">\n    <ion-side-menu-content class="post-size-14px">\n        <ion-nav-bar class="bar app-top-bar">\n            <ion-nav-back-button>\n            </ion-nav-back-button>\n            <ion-nav-buttons side="left">\n                <button class="button button-icon button-clear ion-navicon" menu-toggle="left">\n                </button>\n            </ion-nav-buttons>\n        </ion-nav-bar>\n        <ion-nav-view name="menuContent"></ion-nav-view>\n    </ion-side-menu-content>\n\n    <ion-side-menu side="left" class="main-menu" expose-aside-when="large">\n        <ion-content>\n            <ion-list>\n                <ion-item class="heading-item item item-avatar" nav-clear menu-close ui-sref="app.user">\n                    <div class="user-image-container">\n                        <pre-img ratio="_1_1" helper-class="rounded-image">\n                            <img class="user-image" ng-src="{{profilePhoto}}" spinner-on-load>\n                        </pre-img>\n                    </div>\n                    <h2 class="greeting">{{\'GENERIC.HI\' | translate}} {{currentUsername}}</h2>\n                    <p class="message">{{\'GENERIC.WELCOME\' | translate}} </p>\n                </ion-item>\n                <ion-item class="item-icon-left" nav-clear menu-close href="#/app/search">\n                    <i class="icon ion-radio-waves"></i>\n                    <h2 class="menu-text">{{\'MENU.BUSINESS_CONTACT_SEARCH\' | translate}}</h2>\n                </ion-item>\n                <ion-item class="item-icon-left" nav-clear menu-close href="#/app/favorites">\n                    <i class="icon ion-asterisk"></i>\n                    <h2 class="menu-text">{{\'MENU.FAVORITES\' | translate}}</h2>\n                </ion-item>\n                <ion-item class="item-icon-left" nav-clear menu-close href="#/app/messages">\n                    <i class="icon ion-bookmark"></i>\n                    <h2 class="menu-text">{{\'MENU.HISTORY\' | translate}}</h2>\n                </ion-item>\n            </ion-list>\n        </ion-content>\n    </ion-side-menu>\n</ion-side-menus>\n\n'),e.put("message-details.html",'\n<ion-view class="wordpress-view" ng-controller="MessageCtrl">\n    <form name="messageForm" novalidate>\n    <ion-nav-buttons side="left">\n        <button menu-toggle="left" class="button button-icon icon ion-navicon"></button>\n    </ion-nav-buttons>\n    <ion-nav-title>\n        <span>{{\'MESSAGES.DETAILS_TITLE\' | translate}}</span>\n    </ion-nav-title>\n    <ion-content>\n\n        <div class="posts-list" ng-hide="isLoading">\n            <div class="list card post-item">\n\n                <div class="post-heading item item-text-wrap">\n                    <h2 class="post-title">{{currentMessage.Question}}</h2>\n                    <p class="post-author">\n                       {{currentMessage.createdAt | date:\'dd.MM.yyyy HH:mm\'}}\n                    </p>\n                </div>\n                <div class="post-content item item-text-wrap" post-content>\n                    <div ng-switch="currentMessage.ChannelTypeID">\n                        <div class="row button-block " style="text-align: center; display: block;">\n                            <div ng-switch-when="1" class="ion-ios-telephone" style="font-size: 86px; color: lightgray;"></div>\n                            <div ng-switch-when="2" class="icon ion-email" style="font-size: 86px; color: lightgray;"></div>\n                            <div ng-switch-when="3" class="ion-social-twitter" style="font-size: 86px; color: lightgray;"></div>\n\n                        </div>\n                    </div>\n                    <div ng-show="messageOptions.length > 0" style="padding: 10px;">\n                        <p ng-repeat="option in messageOptions" style="text-align: center; width: 100%;">{{option.NodeName}}</p>\n                    </div>\n                    <p style="text-align: center; padding: 10px;">{{currentMessage.Notes}}</p>\n                    <div class="post-tags item item-text-wrap" ng-repeat="attachment in currentAttachments"  ng-show="currentAttachments.length > 0">\n                        <span class="post-tag button button-small button-outline button-stable" ng-click="selectDocument(attachment)" >{{attachment.name | Filename}}</span>\n                    </div>\n\n                </div>\n            </div>\n        </div>\n\n    </ion-content>\n    <ion-footer-bar class="post-footer bar bar-footer bar-dark">\n        <div class="row">\n            <div class="col col-20 col-offset-10 col-center">\n                <a class="button button-icon icon icon-right ion-android-attach"  ng-click="addImage();"></a>\n            </div>\n            <div class="col col-20 col-offset-10 col-center">\n                <a class="button button-icon icon icon-right ion-chatbox"  ng-click="openNoteModal();"></a>\n            </div>\n            <div class="col col-20 col-offset-10 col-center">\n                <a class="button button-icon icon icon-right ion-help-buoy"  ng-click="openSupport();"></a>\n            </div>\n\n        </div>\n    </ion-footer-bar>\n    </form>\n</ion-view>\n'),e.put("message-list.html",'<ion-view class="category-feeds-view" ng-controller="MessageHistoryCtrl">\n    <ion-nav-title>\n        <span>{{\'MESSAGES.HISTORY_TITLE\' | translate}}</span>\n    </ion-nav-title>\n    <ion-content>\n        <div class="list category-feeds">\n            <a ng-repeat="message in messages track by message.id" class="item item-icon-right"\n               ng-click="selectMessage(message)">\n                <div class="thumbnail-outer">\n                    <div class="thumbnail-outer" ng-switch="message.ChannelTypeID">\n\n                        <i ng-switch-when="1" class="thumbnail icon ion-ios-telephone" style="padding-top: 20px;"></i>\n                        <i ng-switch-when="2" class="thumbnail icon ion-email" style="padding-top: 20px;"></i>\n                        <i ng-switch-when="3" class="thumbnail icon ion-social-twitter" style="padding-top: 20px;"></i>\n\n                    </div>\n                </div>\n                <div>\n                    <span class="title">{{message.OrgID.orgName}}</span>\n\n                    <p class="description">{{message.createdAt | date:\'dd.MM.yyyy\'}}</p>\n                </div>\n                <i class="icon ion-arrow-right-c"></i>\n            </a>\n        </div>\n    </ion-content>\n</ion-view>\n'),e.put("message-note.html",'<ion-modal-view>\n    <ion-header-bar align-title="left">\n        <h1 class="title">{{\'MESSAGES.NOTE_TITLE\' | translate }}</h1>\n        <div class="buttons">\n            <button class="button button-clear" ng-click="closeModal();">{{\'GENERIC_CLOSE\' | translate}}</button>\n        </div>\n    </ion-header-bar>\n    <ion-content scroll="false" ng-controller="AuthorizationCtrl">\n        <form name="messageNoteForm" ng-submit="saveMessageNote()" novalidate>\n            <div class="list">\n\n                <label class="item item-input">\n\n                    <textarea placeholder="Note" name="username" ng-model="currentMessage.Notes" rows="5"></textarea>\n\n                </label>\n\n                <label class="item">\n                    <button class="button button-block button-assertive wrppr-action-button"  type="submit">Save</button>\n                </label>\n            </div>\n        </form>\n    </ion-content>\n</ion-modal-view>'),e.put("new-document.html",'<ion-modal-view>\n    <ion-header-bar align-title="left">\n        <h1 class="title">{{\'ATTACHMENT.NEW_TITLE\' | translate}}</h1>\n        <div class="buttons">\n            <button class="button button-clear" ng-click="closeModal()">{{\'GENERIC_CLOSE\' | translate}}</button>\n        </div>\n    </ion-header-bar>\n    <ion-content scroll="false">\n        <form name="newDocumentForm" ng-submit="closeAttachmentModal(attachment.filename)" novalidate>\n            <div class="list">\n\n                <label class="item item-input">\n                    <span class="input-label">{{\'ATTACHMENT.FILENAME\' | translate}}</span>\n                    <input type="text" name="username" ng-model="attachment.filename">\n\n                </label>\n\n                <label class="item">\n                    <button class="button button-block button-assertive wrppr-action-button" ng-disabled="newDocument.$invalid" type="submit">{{\'ATTACHMENT.SAVE\' | translate}}</button>\n                </label>\n            </div>\n        </form>\n    </ion-content>\n</ion-modal-view>'),e.put("no-internet.html",'<ion-view view-title="{{\'OFFLINE.TITLE\' | translate}}" ng-controller="AppCtrl">\n\n\n    <ion-content style="margin-left: 20px; margin-right: 20px;">\n\n        <div class="row button-block " style="text-align: center; display: block;">\n            <div class="ion-android-wifi" style="font-size: 86px; color: lightgray;"></div>\n\n        </div>\n        <div class="row"><h4 class="title" style="width: 100%; text-align: center;">{{\'OFFLINE.TEXT\' | translate}}</h4></div>\n        <div class="row"><h4 class="title" style="width: 100%; text-align: center;">{{\'OFFLINE.DESCRIPTION\' | translate}}</h4></div>\n        <div class="row" style="height: 30%"></div>\n        <div class="row">\n\n            <button class="button button-large button-assertive wrppr-action-button" style="width: 100%;" ng-click="refreshNetworkState()">\n                {{\'OFFLINE.REFRESH\' | translate}}\n            </button>\n\n        </div>\n\n\n\n    </ion-content>\n\n\n</ion-view>'),e.put("option-list.html",'\n<ion-view view-title="{{currentOrganization}}" ng-controller="OptionsCtrl">\n    <ion-content ng-show="showOptions">\n        <div style="height: 5px; background-color: white;" ng-style="{\'background-color\': brandingColor}"></div>\n\n        <ion-list ng-init="load();">\n            <ion-item ng-repeat="option in options track by option.id" ng-click="selectOption(option);">\n                {{option.NodeName}}\n            </ion-item>\n        </ion-list>\n    </ion-content>\n\n    <ion-content ng-hide="showOptions">\n        <div ng-include src="\'actions.html\'"></div>\n    </ion-content>\n</ion-view>'),e.put("organization-list.html",'<ion-view>\n    <ion-nav-title>\n        <span>{{ \'BUSINESS_CONTACT.SEARCH\' | translate }}</span>\n    </ion-nav-title>\n\n    <ion-header-bar class="bar bar-subheader item-input-inset">\n        <label class="item-input-wrapper">\n            <i class="icon ion-ios-search placeholder-icon"></i>\n            <input type="search" placeholder="{{ \'BUSINESS_CONTACT.SEARCH_FILTER_PLACEHOLDER\' | translate }}" ng-model="search.model">\n            <a ng-if="search.model != \'\'"\n               on-touch="search.model=\'\'">\n                <i class="icon ion-ios-close placeholder-icon"></i>\n            </a>\n        </label>\n    </ion-header-bar>\n\n    <ion-content >\n\n\n\n        <ion-list>\n            <ion-item ng-repeat="organisation in organizations track by organisation.id" ng-click="selectOrganisation(organisation);">\n                {{organisation.orgName}}\n            </ion-item>\n        </ion-list>\n\n        <ion-infinite-scroll\n                ng-if="!noMoreItemsAvailable"\n                immediate-check="false"\n                on-infinite="loadNext()"\n                distance="10%">\n        </ion-infinite-scroll>\n\n\n    </ion-content>\n\n</ion-view>'),e.put("rating.html",'<ion-modal-view>\n    <ion-header-bar align-title="left">\n        <h1 class="title">{{\'RATING.TITLE\' | translate}}</h1>\n        <div class="buttons">\n            <button class="button button-clear" ng-click="closeModal();">{{\'GENERIC_CLOSE\' | translate}}</button>\n        </div>\n    </ion-header-bar>\n\n\n\n    <ion-content style="margin-left: 20px; margin-right: 20px;">\n\n        <div class="row button-block " style="text-align: center; display: block;">\n            <div class="ion-star" style="font-size: 86px; color: lightgray;"></div>\n\n        </div>\n        <div class="row" ng-hide="isRated"><h4 class="title" style="width: 100%; text-align: center;">{{\'RATING.TEXT\' | translate}}{{userName}}</h4></div>\n        <div class="row" ng-hide="isRated"><h4 class="title" style="width: 100%; text-align: center;">{{\'RATING.DESCRIPTION\' | translate}}</h4></div>\n\n\n        <div class="row" ng-show="isRated"><h4 class="title" style="width: 100%; text-align: center;">{{\'RATING.THANKS\' | translate}}{{userName}}</h4></div>\n\n\n        <div class="row" style="height: 20px"></div>\n        <div class="row" ng-hide="isRated">\n            <div class="col">\n                <div class="features-box-icon" ng-click="ratePositive();">\n                    <span aria-hidden="true" class="ion-happy"></span>\n                    <button class="button button-clear">\n\n                    </button>\n                </div>\n\n            </div>\n\n            <div class="col">\n                <div class="features-box-icon" ng-click="rateNegative();">\n                    <span aria-hidden="true" class="ion-sad"></span>\n                    <button class="button button-clear">\n\n                    </button>\n                </div>\n\n            </div>\n        </div>\n\n\n\n    </ion-content>\n\n\n</ion-modal-view>'),e.put("tabs.html",'<ion-view>\n    <ion-tabs class="tabs-icon-top tabs-color-active-assertive">\n\n        <ion-tab title="tab1" icon="ion-man" ui-sref="intro.login">\n            <ion-nav-view name="tab-tab1"></ion-nav-view>\n        </ion-tab>\n\n        <ion-tab title="tab2" icon="ion-person-stalker" ui-sref="intro.register">\n            <ion-nav-view name="menuContent"></ion-nav-view>\n        </ion-tab>\n    </ion-tabs>\n</ion-view>'),e.put("user-correct.html",'<ion-modal-view>\n    <ion-header-bar align-title="left">\n        <h1 class="title">{{ \'USER_CORRECT.TITLE\' | translate }}</h1>\n        <div class="buttons">\n            <button class="button button-clear" ng-click="closeModal();">{{\'GENERIC_CLOSE\' | translate}}</button>\n        </div>\n    </ion-header-bar>\n    <ion-content scroll="false" ng-controller="AuthorizationCtrl">\n        <form name="userCorrectForm" ng-submit="submitUserCorrect(\'Usercorrect\', userCorrect.comment)" novalidate>\n            <div class="list">\n                <label class="item">\n                    {{ \'USER_CORRECT.DESCRIPTION\' | translate }}\n                </label>\n\n\n                <label class="item item-input">\n                    <span class="input-label">Comment</span>\n                    <input type="text" name="username" ng-model="userCorrect.comment">\n\n                </label>\n\n                <label class="item">\n                    <button class="button button-block button-assertive wrppr-action-button" ng-disabled="userCorrectForm.$invalid" type="submit">{{ \'USER_CORRECT.SUBMIT\' | translate }}</button>\n                </label>\n\n\n            </div>\n        </form>\n    </ion-content>\n</ion-modal-view>'),e.put("user-feedback.html",'<ion-modal-view>\n    <ion-header-bar align-title="left">\n        <h1 class="title">{{\'GENERIC.FEEDBACK\' | translate}}</h1>\n        <div class="buttons">\n            <button class="button button-clear" ng-click="closeModal();">{{\'GENERIC_CLOSE\' | translate}}</button>\n        </div>\n    </ion-header-bar>\n    <ion-content scroll="false" ng-controller="AuthorizationCtrl">\n        <form  ng-submit="submitUserCorrect(\'feedback\', comment )" novalidate>\n            <div class="list">\n                <label class="item">\n                    {{\'GENERIC.FEEDBACK_MSG\' | translate}}\n                </label>\n\n\n                <label class="item item-input">\n                    <span class="input-label">{{\'GENERIC.COMMENT\' | translate}}</span>\n                    <input type="text" name="username" ng-model="comment">\n\n                </label>\n\n                <label class="item">\n                    <button class="button button-block button-assertive wrppr-action-button"  type="submit">Save</button>\n                </label>\n\n\n            </div>\n        </form>\n    </ion-content>\n</ion-modal-view>'),e.put("user-support.html",'<ion-modal-view>\n    <ion-header-bar align-title="left">\n        <h1 class="title">{{\'GENERIC.SUPPORT\' | translate}}</h1>\n        <div class="buttons">\n            <button class="button button-clear" ng-click="closeModal();">{{\'GENERIC_CLOSE\' | translate}}</button>\n        </div>\n    </ion-header-bar>\n    <ion-content scroll="false" ng-controller="AuthorizationCtrl">\n        <form  ng-submit="submitUserCorrect(\'support\', comment )" novalidate>\n            <div class="list">\n                <label class="item">\n                    {{\'GENERIC.SUPPORT_MSG\' | translate}}\n                </label>\n\n\n                <label class="item item-input">\n                    <span class="input-label">{{\'GENERIC.COMMENT\' | translate}}</span>\n                    <input type="text" name="username" ng-model="comment">\n\n                </label>\n\n                <label class="item">\n                    <button class="button button-block button-assertive wrppr-action-button"  type="submit">Save</button>\n                </label>\n\n\n            </div>\n        </form>\n    </ion-content>\n</ion-modal-view>'),e.put("user.html",'\n<ion-view class="profile-view" ng-controller="UserCtrl">\n    <ion-nav-title>\n        <span>{{localUser.UserName}}</span>\n    </ion-nav-title>\n    <ion-content>\n        <div class="top-content row">\n            <div class="profile-container">\n                <div class="user-image-container">\n                    <pre-img ratio="_1_1" helper-class="rounded-image">\n                        <img class="user-image" ng-src="{{profilePhoto}}" spinner-on-load>\n                    </pre-img>\n                </div>\n                <div class="user-name">{{localUser.UserName}}</div>\n                <div class="user-twitter">{{user.email}}</div>\n                <div class="user-twitter">{{user.createdAt | date:\'medium\' }}</div>\n            </div>\n            <div class="user-background-image-outer">\n                <div multi-bg=""></div>\n            </div>\n        </div>\n        <div class="bottom-content">\n            <div class="user-bio">\n                <p></p>\n            </div>\n        </div>\n\n\n    </ion-content>\n    <ion-footer-bar class="post-footer bar bar-footer bar-dark">\n        <div class="row">\n            <div class="col col-50 col-offset-10 col-center">\n                <a class="button button-icon icon icon-right ion-at"  ng-click="switchLanguage();"></a>\n            </div>\n            <div class="col col-50 col-offset-10 col-center">\n                <a class="button button-icon icon icon-right ion-android-walk"  ng-click="logout();"></a>\n            </div>\n\n\n        </div>\n    </ion-footer-bar>\n</ion-view>\n'),e.put("auth/auth.html",'<ion-nav-view class="auth-outer">\n    <!--<div multi-bg="[\'img/bg-gif.gif\']"></div> -->\n    <div multi-bg="[\'img/bg_mini.jpg\']"></div>\n</ion-nav-view>\n'),e.put("auth/change-password.html",'\n<ion-view class="forgot-password-view auth-view" cache-view="false">\n    <ion-content scroll="false">\n        <div class="row">\n            <div class="col col-center">\n                <div class="card forgot-password-container" ng-controller="RestorePasswordCtrl">\n                    <form name="changePasswordForm" ng-submit="doChangePassword()" class="" novalidate>\n                        <div class="item item-body">\n                            <label class="item item-input">\n                                <input type="password" placeholder="{{\'PASSWORD\' | translate}}" ng-model="newPassword" required>\n                            </label>\n                        </div>\n                        <label class="item password-complexity row" ng-show="passwordComplexity">\n                            <div class="col" ng-class="passwordComplexity"></div>\n                        </label>\n                        <label class="item item-input" ng-show="!changePasswordForm.newPassword.$pristine && changePasswordForm.newPassword.$invalid">\n                            <p ng-show="changePasswordForm.newPassword.$error.required">{{\'PASSWORD_REQUIRED_VALIDATOR\' | translate}}</p>\n                        </label>\n                        <label class="item item-input">\n                            <input type="password" placeholder="{{\'CHANGE_PASSWORD.REPEAT_PASSWORD\' | translate}}" ng-model="repeatPassword" required>\n                        </label>\n                        <label class="item item-input" ng-show="!changePasswordForm.repeatPassword.$pristine && !passwordMatch">\n                            <p ng-show="!passwordMatch">{{\'CHANGE_PASSWORD.PASSWORD_MATCH\' | translate}}</p>\n                        </label>\n\n                        <div class="item item-body bottom-content">\n                            <button type="submit" class="button button-positive button-block"  ng-disabled="changePasswordForm.$invalid || !passwordMatch" type="submit">\n                                {{\'CHANGE_PASSWORD.SUBMIT\' | translate}}\n                            </button>\n                        </div>\n                    </form>\n                </div>\n                <div class="alternative-actions">\n                    <a class="log-in button button-small button-clear button-light" ui-sref="auth.walkthrough">\n                        {{\'LOGIN_BUTTON\' | translate}}\n                    </a>\n                    <a class="sign-up button button-small button-clear button-light" ui-sref="auth.signup">\n                        {{\'GENERIC.SUPPORT\' | translate}}\n                    </a>\n                </div>\n            </div>\n        </div>\n    </ion-content>\n</ion-view>\n'),
e.put("auth/forgot-password.html",'\n<ion-view class="forgot-password-view auth-view" cache-view="false">\n    <ion-content scroll="false">\n        <div class="row">\n            <div class="col col-center">\n                <div class="card forgot-password-container" ng-controller="RestorePasswordCtrl">\n                    <form name="restorePasswordForm" ng-submit="doRestorePassword()" class="" novalidate>\n                        <div class="item item-body">\n                            <label class="item item-input">\n                                <input type="text" placeholder="{{\'USERNAME\' | translate}}" name="username" ng-model="username" required>\n                            </label>\n                        </div>\n                        <label class="item item-input" ng-show="!restorePasswordForm.username.$pristine && restorePasswordForm.username.$invalid">\n                            <p ng-show="restorePasswordForm.username.$error.required">{{\'USERNAME_REQUIRED_VALIDATOR | translate\'}}</p>\n                        </label>\n                        <div class="item item-body bottom-content">\n                            <button type="submit" class="button button-positive button-block"  ng-disabled="restorePasswordForm.$invalid">\n                                {{ \'CHANGE_PASSWORD.RESTORE_SUBMIT\' | translate }}\n                            </button>\n                        </div>\n                    </form>\n                </div>\n                <div class="alternative-actions">\n                    <a class="log-in button button-small button-clear button-light" ui-sref="auth.login">\n                        {{\'LOGIN_BUTTON\' | translate}}\n                    </a>\n                    <a class="sign-up button button-small button-clear button-light" ui-sref="auth.signup">\n                        Sign Up\n                    </a>\n                </div>\n            </div>\n        </div>\n    </ion-content>\n</ion-view>'),e.put("auth/login.html",'<ion-view class="login-view auth-view" cache-view="false">\n  <ion-content scroll="false">\n    <div class="row">\n      <div class="col col-center">\n        <div class="card login-container" content-tabs tabsdata=\'tabsdata\' ng-controller="AuthorizationCtrl">\n          <form name="loginForm" ng-submit="doLogin()" class="" novalidate ng-cloak>\n            <my-tabs>\n              <my-tab title="{{\'LOGIN_TITLE\' | translate}}">\n                <div class="list">\n                  <label class="item item-input">\n                    <input type="text" placeholder="{{\'USERNAME\' | translate}}" name="username" ng-model="loginData.UserName" required>\n                  </label>\n                    <label class="item item-input" ng-show="!loginForm.username.$pristine && loginForm.username.$invalid">\n                        <p ng-show="loginForm.username.$error.required">{{\'USERNAME_REQUIRED_VALIDATOR\' | translate}}</p>\n                    </label>\n                  <label class="item item-input" show-hide-container>\n                    <input type="password" placeholder="{{\'PASSWORD\' | translate}}" name="password" ng-model="loginData.Password" required show-hide-input required>\n                  </label>\n                    <label class="item item-input" ng-show="!loginForm.password.$pristine && loginForm.password.$invalid">\n                        <p ng-show="loginForm.password.$error.required">{{\'PASSWORD_REQUIRED_VALIDATOR\' | translate}}</p>\n                    </label>\n                </div>\n              </my-tab>\n            </my-tabs>\n            <div class="item item-body bottom-content">\n              <button type="submit" class="button button-positive button-block" ng-disabled="loginForm.$invalid">\n                  {{\'LOGIN_BUTTON\' | translate}}\n              </button>\n            </div>\n          </form>\n        </div>\n        <div class="alternative-actions">\n          <a class="forgot-password button button-small button-clear button-light" ui-sref="auth.restorepassword">\n            {{\'FORGOT_PASSWORD_BUTTON\' | translate}}\n          </a>\n          <a class="sign-up button button-small button-clear button-light" ui-sref="auth.signup">\n            {{\'DASHBOARD.REGISTER\' | translate}}\n          </a>\n        </div>\n      </div>\n    </div>\n  </ion-content>\n</ion-view>\n'),e.put("auth/restore-password.html",'\n<ion-view class="forgot-password-view auth-view" cache-view="false">\n    <ion-content scroll="false">\n        <div class="row">\n            <div class="col col-center">\n                <div class="card forgot-password-container" ng-controller="RestorePasswordCtrl">\n                    <form name="restorePasswordForm" ng-submit="doRestorePassword()" class="" novalidate>\n                        <div class="item item-body">\n                            <label class="item item-input">\n                                <input type="text" placeholder="{{\'USERNAME\' | translate}}" name="username" ng-model="username" required>\n                            </label>\n                        </div>\n                        <label class="item item-input" ng-show="!restorePasswordForm.username.$pristine && restorePasswordForm.username.$invalid">\n                            <p ng-show="restorePasswordForm.username.$error.required">{{\'USERNAME_REQUIRED_VALIDATOR | translate\'}}</p>\n                        </label>\n                        <div class="item item-body bottom-content">\n                            <button type="submit" class="button button-positive button-block"  ng-disabled="restorePasswordForm.$invalid">\n                                {{ \'CHANGE_PASSWORD.RESTORE_SUBMIT\' | translate }}\n                            </button>\n                        </div>\n                    </form>\n                </div>\n                <div class="alternative-actions">\n                    <a class="log-in button button-small button-clear button-light" ui-sref="auth.walkthrough">\n                        {{\'LOGIN_BUTTON\' | translate}}\n                    </a>\n                    <a class="sign-up button button-small button-clear button-light" ui-sref="auth.signup">\n                        {{\'DASHBOARD.REGISTER\' | translate}}\n                    </a>\n                </div>\n            </div>\n        </div>\n    </ion-content>\n</ion-view>\n\n'),e.put("auth/signup.html",'<ion-view class="signup-view auth-view" cache-view="false">\n  <ion-content scroll="false">\n    <div class="row">\n      <div class="col col-center">\n        <div class="card sign-up-container" ng-controller="AuthorizationCtrl">\n          <form class=""  name="registerForm" ng-submit="doRegister()" novalidate>\n            <div class="item item-body">\n              <label class="item item-input">\n                  <input placeholder="{{\'USERNAME\' | translate}}" type="text" name="UserName" ng-model="registerData.UserName" ng-change="resetValidators(\'UserName\');" required>\n              </label>\n              <label class="item item-input" ng-show="!registerForm.UserName.$pristine && registerForm.UserName.$invalid">\n                    <p ng-show="registerForm.UserName.$error.required">{{\'USERNAME_REQUIRED_VALIDATOR\' | translate}}</p>\n                    <p ng-show="registerForm.UserName.$error.unique">{{\'USERNAME_NOT_UNIQUE_VALIDATOR\' | translate}}</p>\n              </label>\n              <label class="item item-input" show-hide-container>\n                <input placeholder="{{\'PASSWORD\' | translate}}" type="password" name="Password" ng-model="registerData.Password" ng-change="resetValidators(\'Password\');" ng-minlength="6" ng-maxlength="50" required show-hide-input>\n              </label>\n              <label class="item password-complexity row" ng-show="passwordComplexity">\n                    <div class="col" ng-class="passwordComplexity"></div>\n               </label>\n                <label class="item item-input" ng-show="!registerForm.Password.$pristine && registerForm.Password.$invalid">\n                    <p ng-show="registerForm.Password.$error.minlength">{{\'PASSWORD_MIN_LENGTH_VALIDATOR\' | translate}}</p>\n                    <p ng-show="registerForm.Password.$error.maxlength">{{\'PASSWORD_MAX_LENGTH_VALIDATOR\' | translate}}</p>\n                </label>\n                <label class="item item-input">\n                    <input placeholder="{{\'REGISTER.MOBILE\' | translate}}" type="tel" pattern="+[0-9]*" ng-model="registerData.mobile" required>\n                </label>\n                <label class="item item-input">\n                    <input placeholder="{{\'REGISTER.EMAIL\' | translate}}" type="email" name="Email" ng-model="registerData.Emailaddress" required>\n                </label>\n                <label class="item item-input" ng-show="!registerForm.Email.$pristine && registerForm.Email.$invalid">\n                    <p ng-show="registerForm.Email.$error.required">{{\'EMAIL_REQUIRED_VALIDATOR\' | translate}}</p>\n                </label>\n            </div>\n            <div class="item item-body bottom-content">\n              <button type="submit" class="button button-assertive button-block" ng-disabled="registerForm.$invalid" type="submit">\n                  {{\'REGISTER.SUBMIT_BUTTON\' | translate}}\n              </button>\n\n            </div>\n          </form>\n        </div>\n        <div class="alternative-actions">\n          <a class="log-in button button-small button-clear button-light" ui-sref="auth.login">\n              {{\'LOGIN_BUTTON\' | translate}}\n          </a>\n          <p class="log-in button-small button-clear button-light" style="text-align: center; padding-top: 20px;" >{{\'GENERIC.PRIVACY_WARNING\' |  translate}}\n              <a href="http://www.mplify.nl/-temporary-slug-fe56b1f7-97e5-46fc-9835-0327a9cdb7bb?hs_preview=hXKmSMPB-3990019867" target="_system">{{\'GENERIC.TERMS_AND_CONDS\' |  translate}}</a>\n              , <a href="http://www.mplify.nl/-temporary-slug-fe56b1f7-97e5-46fc-9835-0327a9cdb7bb?hs_preview=hXKmSMPB-3990019867" target="_system">{{\'GENERIC.PRIVACY_POLICY\' |  translate}}</a> </p>\n        </div>\n      </div>\n    </div>\n  </ion-content>\n</ion-view>\n'),e.put("auth/walkthrough.html",'<ion-view class="walkthrough-view" cache-view="false" ng-controller="DashboardCtrl">\n    <ion-content scroll="false">\n        <div class="top-content row" style="height: 65%;">\n            <div class="col col-center">\n                <h2 style="text-align: center; width: 100%; color: white;">{{\'DASHBOARD.TITLE\' | translate}}</h2>\n\n                <h3 style="text-align: center; width: 100%; color: #A9A9A9;">{{\'DASHBOARD.DESCRIPTION\' | translate}}</h3>\n            </div>\n        </div>\n\n        <div class="bottom-content" style="height: 35%;">\n            <div class="row">\n                <div class="col col-center">\n                    <a class="login button button-block button-stable facebook-button" ng-controller="FacebookCtrl"\n                       ng-show="facebookLoginEnabled" ng-init="facebookAutoLogin()" ng-click="facebookManualLogin()">\n                        <i class="icon ion-social-facebook"></i>\n                        {{\'DASHBOARD.FACEBOOK_LOGIN\' | translate}}\n                    </a>\n\n                    <a class="login button button-block button-stable" ng-controller="TwitterCtrl"\n                       ng-show="twitterLoginEnabled" ng-click="twitterLogin()">\n                        {{\'DASHBOARD.TWITTER_LOGIN\' | translate}}\n                    </a>\n\n\n                </div>\n\n\n            </div>\n            <div class="row">\n                <div class="col col-center" style="text-align: center;">\n                    <a class="button button-small button-clear button-light" ui-sref="auth.login">\n                        {{\'LOGIN_BUTTON\' | translate}}\n                    </a>\n                </div>\n                <div class="col col-center" style="text-align: center;">\n                    <a class="button button-small button-clear button-light" ui-sref="auth.signup">\n                        {{\'DASHBOARD.REGISTER\' | translate}}\n                    </a>\n                </div>\n            </div>\n        </div>\n        </div>\n    </ion-content>\n</ion-view>\n'),e.put("common/ionic-youtube-video.html",'<youtube-video video-id="videoId" player="yt_video" player-vars="playerVars"></youtube-video>\n'),e.put("common/multi-bg.html",'<div class="multi-bg-outer" ng-class="{ \'finish-loading\': loaded }">\n	<img bg class="multi-bg {{ helperClass }}" ng-src="{{ bg_img }}"/>\n	<span class="bg-overlay"></span>\n	<ion-spinner ng-show="!loaded" class="spinner-on-load"></ion-spinner>\n	<!-- <span ng-show="!loaded" class="spinner-on-load ion-load-c"></span> -->\n	<ng-transclude></ng-transclude>\n</div>\n'),e.put("common/my-tab.html",'<div class="tab-content ng-cloak ng-hide" ng-cloak ng-show="selected" ng-transclude></div>\n'),e.put("common/my-tabs.html",'<div class="item item-divider card-heding">\n	<div class="tabs-striped">\n		<div class="tabs">\n			<a ng-repeat="tab in tabs" ng-click="select(tab)" ng-class="{ active: tab.selected }" class="tab-item">{{tab.title}}</a>\n		</div>\n	</div>\n</div>\n<div class="item item-body">\n	<div class="tabs-content" ng-transclude></div>\n</div>\n'),e.put("common/pre-img.html",'\n<div class="pre-img {{ratio}} {{ helperClass }}" ng-class="{ \'finish-loading\': loaded }">\n    <ion-spinner ng-show="!loaded" class="spinner-on-load"></ion-spinner>\n    <!-- <span ng-show="!loaded" class="spinner-on-load ion-load-c"></span> -->\n    <ng-transclude></ng-transclude>\n</div>'),e.put("common/show-hide-password.html",'<div class="show-hide-input" ng-transclude>\n</div>\n<a class="toggle-view-anchor" on-touch="toggleType($event)">\n	<span class="ion-eye-disabled" ng-show="show"></span>\n	<span class="ion-eye" ng-show="!show"></span>\n</a>\n')}]),angular.module("App.directives",[]).directive("myTabs",function(){return{restrict:"E",transclude:!0,scope:{},controller:["$scope",function(e){var n=e.tabs=[];e.select=function(t){angular.forEach(n,function(e){e.selected=!1}),t.selected=!0,e.$emit("my-tabs-changed",t)},this.addTab=function(t){0===n.length&&e.select(t),n.push(t)}}],templateUrl:"common/my-tabs.html"}}).directive("myTab",function(){return{require:"^myTabs",restrict:"E",transclude:!0,scope:{title:"@"},link:function(e,n,t,o){o.addTab(e)},templateUrl:"common/my-tab.html"}}).directive("validPin",["$http",function(e){return{require:"ngModel",link:function(e,n,t,o){e.$watch(t.ngModel,function(e){"12345"==e?o.$setValidity("valid-pin",!0):o.$setValidity("valid-pin",!1)})}}}]).directive("showHideContainer",function(){return{scope:{},controller:["$scope","$element","$attrs",function(e,n,t){e.show=!1,e.toggleType=function(n){n.stopPropagation(),n.preventDefault(),e.show=!e.show,e.$broadcast("toggle-type",e.show)}}],templateUrl:"common/show-hide-password.html",restrict:"A",replace:!1,transclude:!0}}).directive("showHideInput",function(){return{scope:{},link:function(e,n,t){e.$on("toggle-type",function(e,t){var o=n[0];o.getAttribute("type");t||o.setAttribute("type","password"),t&&o.setAttribute("type","text")})},require:"^showHideContainer",restrict:"A",replace:!1,transclude:!1}}).directive("biggerText",["$ionicGesture",function(e){return{restrict:"A",link:function(n,t,o){e.on("touch",function(e){e.stopPropagation(),e.preventDefault();var n=document.querySelector(o.biggerText),t=document.querySelector(".menu-content"),a=window.getComputedStyle(n,null).getPropertyValue("font-size"),i=parseFloat(a),r=Math.min(i+2,24),s=r+"px";t.classList.remove("post-size-"+a),t.classList.add("post-size-"+s)},t)}}}]).directive("smallerText",["$ionicGesture",function(e){return{restrict:"A",link:function(n,t,o){e.on("touch",function(e){e.stopPropagation(),e.preventDefault();var n=document.querySelector(o.smallerText),t=document.querySelector(".menu-content"),a=window.getComputedStyle(n,null).getPropertyValue("font-size"),i=parseFloat(a),r=Math.max(i-2,12),s=r+"px";t.classList.remove("post-size-"+a),t.classList.add("post-size-"+s)},t)}}}]).directive("ionicYoutubeVideo",["$timeout","$ionicPlatform","youtubeEmbedUtils",function(e,n,t){return{restrict:"E",scope:{videoId:"@"},controller:["$scope","$element","$attrs",function(e,o,a){e.playerVars={rel:0,showinfo:0},n.on("pause",function(){var n=t.ready;n&&e.yt_video.stopVideo()})}],templateUrl:"common/ionic-youtube-video.html",replace:!1}}]).directive("postContent",["$timeout","_","$compile",function(e,n,t){return{restrict:"A",scope:{},link:function(o,a,i){function r(e){var n=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11,})(?:\S+)?$/gim;return e.match(n)?RegExp.$1:!1}e(function(){var e=a.find("iframe");e.length>0&&angular.forEach(e,function(e){var a=angular.element(e),i=a.length>0&&!n.isUndefined(a[0].src)?r(a[0].src):!1;if(i!==!1){var s=t("<ionic-youtube-video video-id='"+i+"'></ionic-youtube-video>")(o);a.parent().append(s),a.remove()}})},10)}}}]).directive("dynamicAnchorFix",["$ionicGesture","$timeout","$cordovaInAppBrowser",function(e,n,t){return{scope:{},link:function(e,o,a){n(function(){var e=o.find("a");e.length>0&&angular.forEach(e,function(e){var n=angular.element(e);n.bind("click",function(e){e.preventDefault(),e.stopPropagation();var n=e.currentTarget.href,o={};t.open(n,"_blank",o).then(function(e){})["catch"](function(e){})})})},10)},restrict:"A",replace:!1,transclude:!1}}]).directive("multiBg",["_",function(e){return{scope:{multiBg:"=",interval:"=",helperClass:"@"},controller:["$scope","$element","$attrs",function(n,t,o){n.loaded=!1;var a=this;this.animateBg=function(){n.$apply(function(){n.loaded=!0,t.css({"background-image":"url("+n.bg_img+")"})})},this.setBackground=function(e){n.bg_img=e},e.isUndefined(n.multiBg)||(e.isArray(n.multiBg)&&n.multiBg.length>1&&!e.isUndefined(n.interval)&&e.isNumber(n.interval)?a.setBackground(n.multiBg[0]):a.setBackground(n.multiBg[0]))}],templateUrl:"common/multi-bg.html",restrict:"A",replace:!0,transclude:!0}}]).directive("bg",function(){return{restrict:"A",require:"^multiBg",scope:{ngSrc:"@"},link:function(e,n,t,o){n.on("load",function(){o.animateBg()})}}}).directive("preImg",function(){return{restrict:"E",transclude:!0,scope:{ratio:"@",helperClass:"@"},controller:["$scope",function(e){e.loaded=!1,this.hideSpinner=function(){e.$apply(function(){e.loaded=!0})}}],templateUrl:"common/pre-img.html"}}).directive("spinnerOnLoad",function(){return{restrict:"A",require:"^preImg",scope:{ngSrc:"@"},link:function(e,n,t,o){n.on("load",function(){o.hideSpinner()})}}}),angular.module("App.services",[]);var services=angular.module("App.services");services.filter("Filename",function(){return function(e){return e.substring(0,e.length-4)}});var services=angular.module("App.services");services.factory("Base64",function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(n){var t,o,a,i,r,s="",l="",c="",u=0;do t=n.charCodeAt(u++),o=n.charCodeAt(u++),l=n.charCodeAt(u++),a=t>>2,i=(3&t)<<4|o>>4,r=(15&o)<<2|l>>6,c=63&l,isNaN(o)?r=c=64:isNaN(l)&&(c=64),s=s+e.charAt(a)+e.charAt(i)+e.charAt(r)+e.charAt(c),t=o=l="",a=i=r=c="";while(u<n.length);return s},decode:function(n){var t,o,a,i,r,s="",l="",c="",u=0,d=/[^A-Za-z0-9\+\/\=]/g;d.exec(n)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),n=n.replace(/[^A-Za-z0-9\+\/\=]/g,"");do a=e.indexOf(n.charAt(u++)),i=e.indexOf(n.charAt(u++)),r=e.indexOf(n.charAt(u++)),c=e.indexOf(n.charAt(u++)),t=a<<2|i>>4,o=(15&i)<<4|r>>2,l=(3&r)<<6|c,s+=String.fromCharCode(t),64!=r&&(s+=String.fromCharCode(o)),64!=c&&(s+=String.fromCharCode(l)),t=o=l="",a=i=r=c="";while(u<n.length);return s}}});var services=angular.module("App.services");services.service("APIInterceptor",["$rootScope","$q","LocalDataService",function(e,n,t){var o=this;o.request=function(n){if(e.$broadcast("check-authorization"),!n.headers.Authorization){var o=t.getBaseToken();o&&(n.headers.Authorization=o)}return n},o.response=function(n){return n.data&&n.data.message&&void 0!==n.data.wrppr_users&&n.data.wrppr_users===!1&&e.$broadcast("unauthorized"),n},o.responseError=function(t){return 401===t.status&&e.$broadcast("unauthorized"),503===t.status&&e.$broadcast("serverdown"),n.reject(t)}}]);var services=angular.module("App.services");services.factory("BasicAuthorizationService",["Base64","$http","$log","LocalDataService",function(e,n,t,o){return{generateToken:function(a,i){a&&i||t.error("trying to generate token with empty credentials"),t.info("set credentials");var r=e.encode(a+":"+i),s="Basic "+r;o.saveBaseToken(s),n.defaults.headers.common.Authorization=s},setToken:function(e){t.info("update auth token "+e),o.saveBaseToken(e),n.defaults.headers.common.Authorization=e},getToken:function(){return o.getBaseToken()},isAuthorized:function(){var e=o.getBaseToken();return t.info("authorization check: "+e),null!==e&&(n.defaults.headers.common.Authorization=e),null!==e},clearCredentials:function(){document.execCommand("ClearAuthenticationCache"),o.saveBaseToken(""),n.defaults.headers.common.Authorization=""}}}]);var services=angular.module("App.services");services.factory("PasswordComplexity",["$log",function(e){return{check:function(n){if(void 0!==n&&0!==n.length){var t="";void 0===n&&(n="");var o=/[A-Z]/.test(n),a=/[a-z]/.test(n),i=/\d/.test(n),r=/\W/.test(n),s=o+a+i+r;return e.info("test password complexity "+s),t=n.length>=8&&s>=3?"green":n.length>=8&&s>=2?"yellow col-67":"red col-33"}}}}]);var services=angular.module("App.services");services.service("LocalDataService",["localStorageService",function(e){var n={AUTH_TOKEN:"base_token",APP_USER:"wrapper_user",FACEBOOK:"facebook_user",TWITTER_APP_AVAILABLE:"twitter_app",NETWORK_TYPE:"network_type",NETWORK_STATE:"network_state",EXTERNAL_LOAD_URL:"external_load",PHOTO_LIBRARY:"photo_library",INTRO_VISITED:"intro_visited",EMAIL_APP_AVAILABLE:"email_app"};return{saveBaseToken:function(t){e.set(n.AUTH_TOKEN,t)},getBaseToken:function(){return e.get(n.AUTH_TOKEN)},saveUser:function(t){e.set(n.APP_USER,JSON.stringify(t))},loadUser:function(){var t=e.get(n.APP_USER);return JSON.parse(t||"{}")},saveFacebookResponse:function(t){e.set(n.FACEBOOK,JSON.stringify(t))},getFacebookResponse:function(){var t=e.get(n.FACEBOOK);return JSON.parse(t||"{}")},setTwitterApp:function(t){e.set(n.TWITTER_APP_AVAILABLE,t)},hasTwitterApp:function(){return e.get(n.TWITTER_APP_AVAILABLE)},setNetworkType:function(t){e.set(n.NETWORK_TYPE,t)},getNetworkType:function(){return e.get(n.NETWORK_TYPE)},setNetworkState:function(t){e.set(n.NETWORK_STATE,t)},getNetworkState:function(){return e.get(n.NETWORK_STATE)},getExternalURL:function(){return e.get(n.EXTERNAL_LOAD_URL)},clearExternalURL:function(){e.remove(n.EXTERNAL_LOAD_URL)},addPhoto:function(t,o,a){var i=JSON.parse(e.get(n.PHOTO_LIBRARY)||"[]");i.push({name:t,url:o,message:a}),e.set(n.PHOTO_LIBRARY,JSON.stringify(i))},getPhotos:function(){var t=JSON.parse(e.get(n.PHOTO_LIBRARY)||"[]");return t},setIntroScreenVisited:function(t){e.set(n.INTRO_VISITED,t)},getIntroScreenVisited:function(){return e.get(n.INTRO_VISITED)?e.get(n.INTRO_VISITED):!1},setEmailApp:function(t){e.set(n.EMAIL_APP_AVAILABLE,t)},hasEmailApp:function(){return e.get(n.EMAIL_APP_AVAILABLE)}}}]);var services=angular.module("App.services");services.service("TwitterService",["$ionicPlatform","$log","LocalDataService",function(e,n,t){return{checkTwitterApp:function(){n.info("check Twitter App availability");var e="twitter://";ionic.Platform.isAndroid()&&(e="com.twitter.android"),window.cordova&&appAvailability.checkBool(e,function(e){n.info("check Twitter App is available: "+e),t.setTwitterApp(e)})}}}]);var services=angular.module("App.services");services.service("UserService",["$http","$q","$log","api",function(e,n,t,o){return{searchByFacebookAccount:function(a){t.info("search user by facebook account: "+a);var i=o.byName("base-url")+o.byName("user-url"),r=n.defer(),s={};return s={where:'{"FacebookAccount": "'+a+'"}'},e.get(i,{params:s}).success(function(e){e.length>1&&t.error("There is a problem, more then 1 user with "+a+" facebookAccount"),r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},searchByTwitterAccount:function(a){t.info("search user by twitter account: "+a);var i=o.byName("base-url")+o.byName("user-url"),r=n.defer(),s={};return s={where:'{"FacebookAccount": "'+a+'"}'},e.get(i,{params:s}).success(function(e){e.length>1&&t.error("There is a problem, more then 1 user with "+a+" facebookAccount"),r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},searchByEmail:function(a){t.info("search user by email: "+a);var i=o.byName("base-url")+o.byName("user-url"),r=n.defer(),s={};return s={where:'{"Emailaddress": "'+a+'"}'},e.get(i,{params:s}).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},searchByUsername:function(a){t.info("search user by username: "+a);var i=o.byName("base-url")+o.byName("user-url"),r=n.defer(),s={};return s={where:'{"UserName": "'+a+'"}'},e.get(i,{params:s}).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},createUser:function(a){t.info("create user"+a);var i=o.byName("base-url")+o.byName("user-url")+o.byName("create"),r=n.defer();return e.post(i,a).success(function(e){r.resolve(e[0])}).error(function(e){r.reject(e)}),r.promise},updateUser:function(a){t.info("update user"+a);var i=o.byName("base-url")+o.byName("user-url")+o.byName("update")+"/"+a.id,r=n.defer(),s={FacebookToken:a.FacebookToken,FacebookAccount:a.FacebookAccount,Emailaddress:a.Emailaddress};return e.put(i,s).success(function(e){r.resolve(e[0])}).error(function(e){r.reject(e)}),r.promise},loadUser:function(a){t.info("load user details: "+a);var i=o.byName("base-url")+o.byName("user-url")+"/"+a,r=n.defer();return e.get(i,{}).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},changePassword:function(a,i){t.info("change password");var r=o.byName("base-url")+o.byName("change-password-url"),s=n.defer(),l={key:a,password:i};return e.post(r,l).then(function(e){s.resolve(e)},function(e){s.resolve(e)}),s.promise}}}]);var services=angular.module("App.services");services.service("LoginService",["$http","$q","$log","api","LocalDataService",function(e,n,t,o,a){return{autoLogin:function(){t.info("auto login using basic token");var i=n.defer(),r=a.getBaseToken();r||i.reject();var s=o.byName("base-url")+o.byName("login-url");return e.post(s).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},login:function(a){t.info("login");var i=o.byName("base-url")+o.byName("login-url"),r=n.defer();return e.post(i,a).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},restorePassword:function(a){t.info("send restore password email");var i=o.byName("base-url")+o.byName("restore-password-url"),r=n.defer();return e.get(i,{params:{type:"passwordRestore",username:a}}).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},activateUser:function(a){t.info("send activate password email");var i=o.byName("base-url")+o.byName("restore-password-url"),r=n.defer();return e.get(i,{params:{type:"createUser",userID:a}}).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise}}}]);var services=angular.module("App.services");services.service("OrganizationService",["$http","$q","$log","api",function(e,n,t,o){return{getOrganizations:function(a,i){t.info("load organisations: "+a),t.debug(e.defaults.headers.common.Authorization);var r=o.byName("base-url")+o.byName("organization-url"),s=n.defer(),l={sort:"orgName ASC",where:'{"activeInApp" : "X"}'};return void 0!==a&&a.length>0&&(l={where:'{"orgName":{"startsWith":"'+a+'"}, "activeInApp" : "X"}'}),i&&(t.info("use last id paging param "+i),l.skip=i),l.limit=30,e.get(r,{params:l}).success(function(e){s.resolve(e)}).error(function(e){s.reject(e)}),s.promise},getOrganization:function(a){t.info("load organisation details: "+a);var i=o.byName("base-url")+o.byName("organization-url")+"/"+a,r=n.defer(),s={};return e.get(i,{params:s}).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise}}}]);var services=angular.module("App.services");services.service("OptionService",["$http","$q","$log","api",function(e,n,t,o){return{getOptions:function(a,i){t.info("load options:  organization"+a+" parent node id"+i);var r=o.byName("base-url")+o.byName("routing-url"),s=n.defer(),l={OrgID:a,ParentNode:i};return e.get(r,{params:l}).success(function(e){s.resolve(e)}).error(function(e){s.reject(e)}),s.promise},getOptionsTree:function(a){t.info("load options:  organization"+a);var i=o.byName("base-url")+o.byName("routing-tree-url"),r=n.defer(),s={OrgID:a};return e.get(i,{params:s}).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise}}}]);var services=angular.module("App.services");services.service("MessageService",["$http","$q","$log","api",function(e,n,t,o){return{createMessage:function(a){t.info("save message"+a);var i=o.byName("base-url")+o.byName("message-url")+o.byName("create"),r=n.defer();return e.post(i,a).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},loadMessage:function(a){t.info("load message details "+a);var i=o.byName("base-url")+o.byName("message-url")+"/"+a,r=n.defer();return e.get(i).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},getMessagesByUser:function(a,i){t.info("load messages for user: "+a);var r=o.byName("base-url")+o.byName("message-url"),s=n.defer(),l={};return void 0!==a&&(l={UserID:a,sort:"createdAt DESC"}),i&&(l.OrgID=i),e.get(r,{params:l}).success(function(e){s.resolve(e)}).error(function(e){s.reject(e)}),s.promise},getCompaniesWithMsgCount:function(a){t.info("load companies with messages count");var i=o.byName("base-url")+o.byName("companies-messages-url"),r=n.defer(),s={};return void 0!==a&&(s={userID:a}),e.get(i,{params:s}).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},getMessageDetails:function(a){t.info("load message details for: "+a);var i=o.byName("base-url")+o.byName("message-tree-url"),r=n.defer(),s={MessageID:a};return e.get(i,{params:s}).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},updateMessageNote:function(a){t.info("update message note"+a.Notes);var i=o.byName("base-url")+o.byName("message-url")+o.byName("update")+"/"+a.id,r=n.defer(),s={Notes:a.Notes};return e.put(i,s).success(function(e){r.resolve(e[0])}).error(function(e){r.reject(e)}),r.promise}}}]);var services=angular.module("App.services");services.service("DTMFService",["$log","$cordovaContacts",function(e,n){return{createNumber:function(n,t){e.info("convert selected routing to DTMF number");var o=n.TelephoneNumber,a=null,r=t[t.length-1];if(a=t.length>0&&null!==r.AltInitialPause?r.AltInitialPause:n.initialpause,null!==a)for(e.info("add initial pause "+a),i=0;i<a;i++)o+=",";for(var s in t)o=o+","+t[0].DTMFID;return o}}}]);var services=angular.module("App.services");services.service("NetworkService",["$ionicPlatform","$rootScope","$log","$ionicPopup","$cordovaNetwork","$templateCache","$ionicModal","LocalDataService",function(e,n,t,o,a,i,r,s){var l,c=function(){l=r.fromTemplate(i.get("no-internet.html")),l.show()},u=function(){l&&(l.hide(),l.remove())};return{checkNetworkState:function(){var e=a.getNetwork(),o=a.isOnline();t.info("network type: "+e),s.setNetworkState(o),s.setNetworkType(e),o?u():c(),n.$on("networkOnline",function(e,n){var t=n;s.setNetworkState(t),c()}),n.$on("networkOffline",function(e,n){s.setNetworkState(n),u()})}}}]);var services=angular.module("App.services");services.service("ExternalLoad",["LocalDataService","$state","$log",function(e,n,t){var o=function(e,n){var t=RegExp("[?&]"+n+"=([^&]*)").exec(e);return t&&decodeURIComponent(t[1].replace(/\+/g," "));
};return{checkExternalLoad:function(){var a=e.getExternalURL();if(a&&a.indexOf("changepassword")>-1){t.info("redirect to change password screen");var i=o(a,"key");n.go("changepassword",{key:i}),e.clearExternalURL()}}}}]);var services=angular.module("App.services");services.service("FacebookService",["$q","$log","$state","UserService","LocalDataService","BasicAuthorizationService",function(e,n,t,o,a,i){var r=function(){n.info("try to auto login");var e=a.getFacebookResponse();e&&e.accessToken&&s().then(function(o){if("connected"===o.status){n.info("auto logged in via facebook",e);var a=e.email,r="facebook "+e.accessToken;i.generateToken(a,r),t.go("app.search")}},function(e){n.error("facebook auto login failed",e)})},s=function(){n.info("facebook login status");var t=e.defer();return facebookConnectPlugin.getLoginStatus(function(e){n.info("facebook login status success : "+e.status),t.resolve(e)},function(e){t.reject(e)}),t.promise},l=function(t){var o=e.defer();return facebookConnectPlugin.api("/me?fields=email,name&access_token="+t,["public_profile"],function(e){o.resolve(e)},function(e){n.error(e),o.reject(e)}),o.promise},c=function(n,t){var a=e.defer();if(angular.isDefined(n.email)){var i=n.email;o.searchByFacebookAccount(i).then(function(e){if(0===e.length)o.searchByEmail(i).then(function(e){if(0===e.length){var i={UserName:n.email,Emailaddress:n.email,FacebookAccount:n.email,Password:n.email,FacebookToken:t};o.createUser(i).then(function(e){a.resolve(e)},function(e){a.reject(e)})}else{var r=e[0];r.FacebookToken=t,o.updateUser(r).then(function(e){a.resolve(e)},function(e){a.reject(e)})}},function(e){a.reject(e)});else{var r=e[0];r.FacebookToken=t,o.updateUser(r).then(function(e){a.resolve(e)},function(e){a.reject(e)})}},function(e){a.reject(e)})}else a.reject();return a.promise};return{getLoginStatus:s,getProfileInfo:l,saveUser:c,autoLogin:r}}]);var services=angular.module("App.services");services.service("DocumentService",["$cordovaCamera","$cordovaFile","LocalDataService","$log","$q",function(e,n,t,o,a){var i="documents";return{createFolder:function(){var e=a.defer();return n.checkDir(cordova.file.dataDirectory,i).then(function(n){o.debug("directory exists"),e.resolve(n)},function(t){o.error("failed to check folder exists",t),t.code&&1==t.code?n.createDir(cordova.file.dataDirectory,i).then(function(n){o.debug("directory created"),e.resolve(n)},function(n){o.error("failed to create folder exists",n),e.reject(n)}):e.reject(t)}),e.promise},capturePicture:function(){var n=a.defer(),t={quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA,encodingType:Camera.EncodingType.JPEG,cameraDirection:0,saveToPhotoAlbum:!0};return e.getPicture(t).then(function(e){n.resolve(e)},function(e){o.error("failed to capture image",e),n.reject(e)}),n.promise},moveFile:function(e,r,s){var l=a.defer(),c=e.replace(/^.*[\\\/]/,""),u=r+".jpg",d=cordova.file.dataDirectory+i,p=e.substring(0,e.lastIndexOf("/"));return n.moveFile(p,c,d,u).then(function(e){var n=e.nativeURL;t.addPhoto(u,e.nativeURL,s),o.debug("moved file from temp location to ",n),l.resolve(n)},function(e){o.error("failed to move file from temp location",JSON.stringify(e)),l.reject(e)}),l.promise}}}]);var services=angular.module("App.services");services.service("EmailService",["$ionicPlatform","$log","$cordovaFile","LocalDataService",function(e,n,t,o){return{checkEmailApp:function(){n.info("check email availability"),window.cordova&&cordova.plugins.email.isAvailable(function(e){o.setEmailApp(e)})},sendEmail:function(){n.info("send an email");var e=o.getPhotos(),a=e[0].url,i=a.substr(a.lastIndexOf("/")+1),r=a.substr(0,a.lastIndexOf("/")),s=(cordova.file.dataDirectory+i,a.replace("file://",""));alert(a),n.info(r),n.info(i),t.checkFile(r,i).then(function(e){n.debug("exist",e),cordova.plugins.email.open({to:"marykiselova@gmail.com",attachments:[s],subject:"Hi, it s me again",body:"How are you?"})},function(e){n.debug("exist",e)})}}}]);var services=angular.module("App.services");services.service("SupportService",["$http","$q","$log","api",function(e,n,t,o){return{submitSupport:function(a,i,r,s){t.info("create support: "+a+" from "+i);var l=o.byName("base-url")+o.byName("support-url"),c=n.defer(),u={action:a,userName:i,description:r,messageID:s};return e.post(l,u).success(function(e){c.resolve(e)}).error(function(e){c.reject(e)}),c.promise}}}]);var App=angular.module("App.services");App.constant("API",{"proxy-url":"/api","base-url":"https://wrppr-core.herokuapp.com","login-url":"/login","logout-url":"/logout","restore-password-url":"/wrppr_pwRestoreEmail","organization-url":"/wrppr_organizations","routing-url":"/wrppr_routing","routing-tree-url":"/wrppr_routing_tree","user-url":"/wrppr_users","change-password-url":"/wrppr_pwRenew","message-url":"/wrppr_messages","message-tree-url":"/wrppr_message_tree","companies-messages-url":"/wrppr_numMessPerOrg","support-url":"/wrppr_support",create:"/create",update:"/update"}),App.factory("api",["API",function(e){return{byName:function(n){return window.cordova||"base-url"!=n||(n="proxy-url"),e[n]}}}]),angular.module("App.controllers",[]).controller("AppCtrl",["$scope","$rootScope","$state","$window","$log","$ionicPlatform","$ionicModal","$ionicPopup","$ionicLoading","$ionicHistory","$q","$ionicActionSheet","$templateCache","$translate","$timeout","BasicAuthorizationService","UserService","$cordovaOauth","api","$http","LocalDataService","NetworkService","SupportService",function(e,n,t,o,a,i,r,s,l,c,u,d,p,g,m,v,h,f,b,w,A,E,S){n.debugMode=!1,n.sessionData={},e.$on("$ionicView.beforeEnter",function(){n.sessionData.organization&&(null!==n.sessionData.organization.BrandingColor1?n.brandingColor=n.sessionData.organization.BrandingColor1:n.brandingColor="#00CCFF",null!==n.sessionData.organization.BrandingColor2?n.brandingColor2=n.sessionData.organization.BrandingColor2:n.brandingColor2="#00CCFF")}),e.logout=function(){v.clearCredentials(),window.cordova&&facebookConnectPlugin.logout(),A.saveUser({});var e=b.byName("base-url")+b.byName("logout-url");w.get(e,{}).success(function(e){a.debug("logout done")}).error(function(e){}),t.go("auth.walkthrough")},e.$on("serverdown",function(){s.alert({title:g.instant("GENERIC.SERVER_ERROR_TITLE"),template:g.instant("GENERIC.SERVER_ERROR_TEXT")})}),e.$on("unauthorized",function(){a.info("unauthorized, redirect to root"),t.current.name.indexOf("app")>-1&&t.go("auth.walkthrough")}),e.refreshNetworkState=function(){E.checkNetworkState()},e.openSupport=function(){d.show({buttons:[{text:"User correct"},{text:"Feedback"}],titleText:"Feedback",cancelText:"Cancel",buttonClicked:function(n){return 0===n?e.showUserCorrect():1===n&&e.mailFeedback(),!0}})},e.mailFeedback=function(){e.modal=r.fromTemplate(p.get("user-feedback.html"),{scope:e}),e.modal.show()},e.mailSupport=function(){e.modal=r.fromTemplate(p.get("user-support.html"),{scope:e}),e.modal.show()},e.showUserCorrect=function(){e.modal=r.fromTemplate(p.get("user-correct.html"),{scope:e}),e.modal.show()},e.closeModal=function(){e.modal.hide(),e.modal.remove()},e.submitUserCorrect=function(t,o){a.info(o),a.debug("support message details",n.supportMessage),l.show({template:"Submitting"});var i=A.loadUser();n.supportMessage&&(e.messageID=n.supportMessage.id.toString()),S.submitSupport(t,i.UserName,o,e.messageID).then(function(t){l.hide(),s.alert({title:"Support",template:"Thanks, you message send. We will contact you soon."}),e.closeModal(),n.supportMessage={}},function(e){l.hide(),a.error("failed to submit user correct",e),s.alert({title:"Failed",template:e}),n.supportMessage={}})},e.isRated=!1,e.requestRating=function(){e.modal=r.fromTemplate(p.get("rating.html"),{scope:e}),e.modal.show()},e.$on("rating",function(){a.info("show rating screen"),e.requestRating()}),e.ratePositive=function(){a.info("rate positive"),e.isRated=!0,m(e.closeRating,1e3)},e.rateNegative=function(){a.info("rate negative"),e.isRated=!0,m(e.closeRating,1e3)},e.closeRating=function(){e.isRated=!1,e.closeModal()}}]);var controllers=angular.module("App.controllers");controllers.controller("OptionsCtrl",["$scope","$rootScope","$state","$stateParams","$log","$ionicLoading","$ionicHistory","$ionicPopup","$translate","OptionService",function(e,n,t,o,a,i,r,s,l,c){a.debug("init options controller",n.sessionData.options),e.showOptions=!0,e.organizationDetails={},n.$ionicGoBack=function(){t.is("app.options")&&n.sessionData.options.pop(),r.goBack()},e.options=[],e.filtered=[],e.recursiveFilter=function(n,t){angular.forEach(n,function(n){n.NodeID===t&&e.filtered.push(n),angular.isArray(n.children)&&n.children.length>0&&e.recursiveFilter(n.children,t)})},e.load=function(){"0"===o.parentID?e.options=n.organizationDetails.routes:(e.recursiveFilter(n.organizationDetails.routes,o.parentID),a.info("found parent node",e.filtered),e.options=[],e.filtered.length>0&&(e.options=e.filtered[0].children)),0===e.options.length?e.showOptions=!1:e.showOptions=!0},e.currentOrganization=o.orgName,e.selectOption=function(e){a.info("selected option "+e),n.sessionData.options.push(e),t.go("app.options",{orgID:o.orgID,parentID:e.NodeID})}}]);var controllers=angular.module("App.controllers");controllers.controller("AuthorizationCtrl",["$scope","$rootScope","$ionicLoading","$ionicModal","$ionicPopup","$state","$log","$stateParams","$translate","LoginService","BasicAuthorizationService","UserService","PasswordComplexity","LocalDataService",function(e,n,t,o,a,i,r,s,l,c,u,d,p,g){r.info("init auth controller"),e.registerData={},e.loginData={},e.passwordComplexity="",e.loginSubmitted=!1,e.doLogin=function(){r.info("doing login",e.loginData),t.show({template:l.instant("LOGIN.LOADING")}),c.login(e.loginData).then(function(o){if(t.hide(),e.$broadcast("scroll.refreshComplete"),o.wrppr_users===!1)return r.error("login failed: "+o.message),void a.alert({title:"Login failed",template:o.message});var s=o.wrppr_users;g.saveUser(s),g.saveFacebookResponse({}),u.generateToken(e.loginData.UserName,e.loginData.Password),n.currentUsername=e.loginData.UserName,n.profilePhoto="img/photo.jpg",e.resetLoginForm(),i.go("app.search")},function(e){t.hide(),r.error("failed to login",e),a.alert({title:l.instant("LOGIN.FAILED"),template:e})})},e.resetLoginForm=function(){e.loginData.UserName="",e.loginData.Password="",e.loginForm.$setPristine(),e.loginForm.$setUntouched()},e.doRegister=function(){r.info("start registration"),t.show({template:l.instant("REGISTER.LOADING")}),d.createUser(e.registerData).then(function(n){u.generateToken(e.registerData.UserName,e.registerData.Password);var o=n;g.saveUser(o),t.hide(),e.$broadcast("scroll.refreshComplete"),e.resetRegisterForm(),i.go("app.search")},function(n){if(t.hide(),"E_VALIDATION"===n.error)for(var o in n.invalidAttributes){var i=o.replace(/"/g,""),r=n.invalidAttributes[o];for(var s in r)e.registerForm[i].$setValidity(r[s].rule,!1)}a.alert({title:l.instant("REGISTER.FAILED"),template:n.message})})},e.resetRegisterForm=function(){e.registerData={},e.registerForm.$setPristine(),e.registerForm.$setUntouched()},e.resetValidators=function(n){e.registerForm[n].$setValidity("unique",!0),e.registerForm[n].$setValidity("minLength",!0)},e.$watch("registerData.Password",function(n){var t=p.check(n);e.passwordComplexity=t})}]);var controllers=angular.module("App.controllers");controllers.controller("RestorePasswordCtrl",["$scope","$state","$stateParams","$log","$ionicLoading","$ionicPopup","LoginService","PasswordComplexity","UserService",function(e,n,t,o,a,i,r,s,l){o.info("init restore password controller"),e.newPassword="",e.passwordMatch=!0,e.doRestorePassword=function(){a.show({template:"Sends email ..."}),r.restorePassword(e.username).then(function(){a.hide(),i.alert({title:"Restore Password",template:"Please checkout you  email for instructions"}),n.go("auth.walkthrough")},function(e){a.hide();var n=e;e.message&&(n=e.message),i.alert({title:"Failed to restore",template:n})})},e.$watch("newPassword",function(n){var t=s.check(n);e.passwordComplexity=t}),e.$watch("repeatPassword",function(n){void 0!==n&&(n&&e.newPassword===n?e.passwordMatch=!0:e.passwordMatch=!1,o.info("password match "+e.passwordMatch))}),e.doChangePassword=function(){a.show({template:"Saving .."}),o.info("change password");var r=t.key;l.changePassword(r,e.newPassword).then(function(e){a.hide(),i.alert({title:"Password saved",template:"Try to login with new password"}),n.go("auth.walkthrough")},function(e){a.hide(),i.alert({title:"Failed to change password",template:"Please try again"})})}}]);var controllers=angular.module("App.controllers");controllers.controller("DashboardCtrl",["$scope","$log","LocalDataService",function(e,n,t){n.info("init dashboard controller")}]);var controllers=angular.module("App.controllers");controllers.controller("OrganizationsCtrl",["$scope","$rootScope","$ionicLoading","$ionicModal","$templateCache","$state","$log","OrganizationService","LocalDataService","OptionService",function(e,n,t,o,a,i,r,s,l,c){r.info("init organizations controller"),e.introVisited=l.getIntroScreenVisited(),e.showIntro=function(){var n=l.loadUser();e.userName=n.UserName,e.modal=o.fromTemplate(a.get("intro.html"),{scope:e}),e.modal.show()},e.$on("$ionicView.enter",function(){e.introVisited||e.showIntro()}),e.hideIntro=function(){l.setIntroScreenVisited(!0),e.introVisited=!0,e.modal.hide(),e.modal.remove()},e.organizations=[],e.noMoreItemsAvailable=!1,e.isLoading=!1,e.search={model:""},e.load=function(n){r.info("load organizations "+n),t.show({template:"Loading..."}),e.isLoading=!0,s.getOrganizations(n,e.organizations.length).then(function(n){0===n.length&&(e.noMoreItemsAvailable=!0),e.organizations=e.organizations.concat(n),t.hide(),e.isLoading=!1,e.$broadcast("scroll.refreshComplete"),e.$broadcast("scroll.infiniteScrollComplete")},function(n){r.error("Failed to load organizations",n),t.hide(),e.isLoading=!1})},e.loadNext=function(){r.debug("load organizations next page"),e.load(e.search.model)},e.reload=function(n){r.debug("reload organization list"),e.organizations=[],e.noMoreItemsAvailable=!1,e.load(n)},e.selectOrganisation=function(e){n.sessionData.organization=e,n.sessionData.options=[],r.info("organisation selected "+e.orgName),c.getOptionsTree(e.id).then(function(o){r.info("loaded org details"),n.organizationDetails=o,i.go("app.options",{orgID:e.id,parentID:0}),t.hide()},function(e){r.error("failed to load organization details")})},e.$watch("search.model",function(n,t){return e.isLoading?void r.debug("skipped loading organization, prev is not done"):(r.info("search organization model changed: "+n+t),void e.reload(n))})}]);var controllers=angular.module("App.controllers");controllers.controller("ActionCtrl",["$scope","$rootScope","$state","$stateParams","$window","$ionicPlatform","$ionicPopup","$log","$translate","$ionicLoading","$ionicModal","$templateCache","$ionicActionSheet","$timeout","LocalDataService","MessageService","UserService","DTMFService","$cordovaContacts","OrganizationService",function(e,n,t,o,a,i,r,s,l,c,u,d,p,g,m,v,h,f,b,w){s.debug("init action controller"),e.$on("$ionicView.beforeLeave",function(){n.supportMessage={}}),e.init=function(){if(n.supportMessage={},e.currentOrganization={},e.hasWebpage=!1,n.showUserCorrect=!1,n.sessionData.organization?e.currentOrganization=n.sessionData.organization:(s.info("organization not selected, redirects to organization search"),t.go("app.organizations")),e.actionMessages={CALL:{type:1,message:"Called "},MAIL:{type:2,message:"Send email to"},TWEET:{type:3,message:"Send tweet to"},FACEBOOK:{type:4,message:"Send a facebook msg"}},e.contacts={},void 0!==n.sessionData.organization){if(e.currentOrganization=n.sessionData.organization.orgName,e.currentOptions=n.sessionData.options,e.contacts.email=n.sessionData.organization.EmailAddress,e.contacts.twitter=n.sessionData.organization.TwitterAccount,e.contacts.call=n.sessionData.organization.TelephoneNumber,e.hasWebpage=!1,e.generalWebpage=n.sessionData.organization.GeneralWebsite,e.selfServiceWebpage=null,e.communityWebpage=null,e.currentOptions.length>0){var o=e.currentOptions[e.currentOptions.length-1];e.generalWebpage=o.GeneralInformation,e.selfServiceWebpage=o.SelfService,e.communityWebpage=o.Community}(e.generalWebpage||e.selfServiceWebpage||e.communityWebpage)&&(e.hasWebpage=!0)}},e.call=function(){s.info("make a call");var t={filter:l.instant("CONTACT_NAME"),multiple:!0,fields:["displayName","name"],desiredFields:["id"]},o=f.createNumber(n.sessionData.organization,e.currentOptions);window.cordova?(c.show({template:l.instant("ACTIONS.CALL_PROCESS")}),b.find(t).then(function(t){var a=new ContactField(n.sessionData.organization.orgName,o,!1);if(t&&t.length>0){var i=t[0];null===i.phoneNumbers&&(i.phoneNumbers=[]),i.phoneNumbers.push(a),i.save(function(){s.info("saved wrapper contact number"),e.makeCall(o),c.hide()},function(n){s.error("failed to save wrapper contact",n),c.hide(),alert("failed to save wrapper contact"),e.makeCallViaURL(o)})}else{var r={displayName:l.instant("CONTACT_NAME"),phoneNumbers:[a]};b.save(r).then(function(n){s.info("added wrapper contact number"),e.makeCall(o),c.hide()},function(n){s.error("failed to save wrapper contact",err),c.hide(),e.makeCallViaURL(o)})}},function(n){s.error("failed to find wrapper contact",n),c.hide(),e.makeCallViaURL(o)})):e.makeCallViaURL(o),e.logAction(e.actionMessages.CALL)},e.makeCall=function(t){window.plugins.CallNumber.callNumber(function(e){s.info("finish call",e),n.$broadcast("rating")},function(n){s.error("failed call",n),r.alert({title:l.instant("ACTIONS.CALL_FAILED"),template:n}),e.makeCallViaURL(t)},t,!1)},e.makeCallViaURL=function(e){s.debug("call via url"),window.open("tel:"+e,"_system"),n.$broadcast("rating")},e.mail=function(){s.info("send an email"),e.logAction(e.actionMessages.MAIL);var t=l.instant("MAIL.BODY",{company:n.sessionData.organization.orgName}),o="mailto:"+e.contacts.email+"?subject="+l.instant("MAIL.SUBJECT")+"&body="+t;window.open(o,"_system"),n.$broadcast("rating")},e.hasTwitterApp=!1,e.tweet=function(){s.info("tweet"),e.logAction(e.actionMessages.TWEET);var t=m.hasTwitterApp();t?window.open("twitter://user?screen_name="+e.contacts.twitter,"_system","location=no"):window.open("https://twitter.com/intent/tweet?screen_name="+e.contacts.twitter,"_system","location=no"),n.$broadcast("rating")},e.logAction=function(t){var o={OrgID:n.sessionData.organization.id,UserID:m.loadUser().id,Question:t.message+' "'+e.currentOrganization+'"',ChannelTypeID:t.type};if(n.sessionData.options.length>0){var a=n.sessionData.options[n.sessionData.options.length-1];s.debug("try to "+t+" for menu: ",a),o.ChoiceMenuID=a.id}v.createMessage(o).then(function(e){n.showUserCorrect=!0,n.supportMessage=e,n.reloadFavorites=!0,n.reloadMessages=!0},function(e){s.error("failed to save a message",e),r.alert({title:l.instant("ACTIONS.MESSAGE_SAVE_FAIL"),template:e})})},e.webpage=function(){var n=[];if(e.generalWebpage&&n.push({text:l.instant("ACTIONS.WEBPAGE_GENERAL"),url:e.generalWebpage}),e.selfServiceWebpage&&n.push({text:l.instant("ACTIONS.WEBPAGE_SELF_SERVICE"),url:e.selfServiceWebpage}),e.communityWebpage&&n.push({text:"ACTIONS.WEBPAGE_COMMUNITY",url:e.communityWebpage}),0===n.length);else if(1===n.length){var t=n[0].url;s.debug("try to open url ",t),window.open(t,"_system","location=yes")}else{p.show({buttons:n,titleText:l.instant("ACTIONS.WEBPAGE"),cancelText:l.instant("GENERIC.CANCEL"),buttonClicked:function(e){var t=n[e].url;return s.debug("try to open url ",t),window.open(t,"_system","location=yes"),!0}})}}}]);var controllers=angular.module("App.controllers");controllers.controller("UserCtrl",["$scope","$rootScope","$log","$translate","$ionicLoading","UserService","LocalDataService",function(e,n,t,o,a,i,r){e.loadUserDetails=function(n){i.loadUser(n).then(function(n){e.user=n},function(e){t.error("failed to load user details")})},e.load=function(){t.info("load user details from local storage"),e.localUser=r.loadUser(),e.localFBUser=r.getFacebookResponse(),e.sessionKey=r.getBaseToken(),e.networkStatus=r.getNetworkState(),e.networkType=r.getNetworkType(),e.emailApp=r.hasEmailApp(),e.localUser.id&&e.loadUserDetails(e.localUser.id)},e.load(),e.$on("$ionicView.enter",function(){e.load()}),e.switchLanguage=function(){t.info("switch to english"),o.use("en"),a.show({template:"Switching language ..."}),o.refresh()},n.$on("$translateRefreshEnd",function(){a.hide()})}]);var controllers=angular.module("App.controllers");controllers.controller("FacebookCtrl",["$scope","$rootScope","$state","$stateParams","$ionicPlatform","$q","$log","$ionicLoading","$ionicPopup","$http","$cordovaOauth","$translate","UserService","BasicAuthorizationService","LocalDataService","FacebookService",function(e,n,t,o,a,i,r,s,l,c,u,d,p,g,m,v){e.facebookLoginEnabled=window.cordova,e.facebookManualLogin=function(){s.show({template:d.instant("FACEBOOK.LOADING")}),v.getLoginStatus().then(function(n){if("connected"===n.status){var t=n.authResponse.accessToken;v.getProfileInfo(t).then(function(n){v.saveUser(n,t).then(function(o){var a=o;e.updateLocalStorage(a,n,t),s.hide()},function(e){r.error("failed to save profile info"),s.hide(),l.alert({title:d.instant("FACEBOOK.FAILED")})})},function(e){r.error("failed to get profile info"),s.hide(),l.alert({title:d.instant("FACEBOOK.FAILED")})})}else e.openNativeLogin()},function(e){})},e.nativeLoginSuccess=function(n){var t=n.authResponse.accessToken;v.getProfileInfo(t).then(function(n){v.saveUser(n,t).then(function(o){e.updateLocalStorage(o,n,t),s.hide()},function(e){r.error("failed to save user"),s.hide(),l.alert({title:d.instant("FACEBOOK.FAILED"),template:error})})},function(e){r.error("failed to get profile info"),s.hide(),l.alert({title:d.instant("FACEBOOK.FAILED"),template:e})})},e.nativeLoginError=function(e){s.hide()},e.openNativeLogin=function(){facebookConnectPlugin.login(["email","public_profile"],e.nativeLoginSuccess,e.nativeLoginError)},e.updateLocalStorage=function(e,o,a){m.saveUser(e),o.accessToken=a,o.picture="http://graph.facebook.com/"+o.id+"/picture?type=large",n.profilePhoto=o.picture,n.currentUsername=o.name,r.info("profile photo",n.profilePhoto),m.saveFacebookResponse(o),r.info("logged in via facebook",e);var i=e.Emailaddress,s="facebook "+a;g.generateToken(i,s),t.go("app.search")}}]);var controllers=angular.module("App.controllers");controllers.controller("TwitterCtrl",["$scope","$rootScope","$state","$stateParams","$ionicLoading","$ionicPlatform","$log","$cordovaOauth","localStorageService","UserService","BasicAuthorizationService",function(e,n,t,o,a,i,r,s,l,c,u){e.twitterLoginEnabled=!1,e.consumerKey="JVj33eTXGPxlVZxoT8htdqwNK",e.consumerSecret="Q6K9GtYCrxhLPLWfIkr5eTHvpizf4NbEm6sHhkE0pSo0Ts7TFl",e.twitterProfileInfo={},e.loadTwitterUser=function(){e.twitterProfileInfo=c.getUser()},e.twitterLogin=function(){a.show({template:"Logging in..."}),s.twitter(e.consumerKey,e.consumerSecret,{}).then(function(n){r.info("logged in via twitter",n),a.hide(),r.debug("twitter login success",n);var t=n.screen_name,o=n.oauth_token;c.searchByTwitterAccount(t).then(function(n){n.length>0?(r.info("found user with same twitter account",n),e.updateToken(n[0],o)):c.searchByUsername(t).then(function(n){if(n.length>0)e.updateToken(n[0],o);else{var a={UserName:t,TwitterAccount:t,TwitterOauthToken:o};c.createUser(a).then(function(n){e.updateCredentials(n,o)},function(e){})}},function(e){r.error("failed to search user",e)})},function(e){r.error("failed to search user",e)})},function(e){r.error("failed to login via twitter",e),a.hide()})},e.updateToken=function(n,t){n.TwitterOauthToken=t,c.updateUser(n).then(function(o){e.updateCredentials(n,t)},function(e){r.error("failed update user",e)})},e.updateCredentials=function(e,n){r.info("logged in via twitter",e);var o=e.UserName,a="twitter "+n;u.generateToken(o,a),t.go("app.search")}}]);var controllers=angular.module("App.controllers");controllers.controller("IntroCtrl",["$scope","$state","LocalDataService",function(e,n,t){e.$on("$ionicView.beforeEnter",function(){t.getIntroScreenVisited()&&n.go("app.search")}),e.$on("$ionicView.beforeLeave",function(){t.setIntroScreenVisited(!0)}),e.init=function(){var n=t.loadUser();e.userName=n.UserName}}]);var controllers=angular.module("App.controllers");controllers.controller("MessageHistoryCtrl",["$scope","$rootScope","$state","$log","$stateParams","$ionicLoading","$ionicHistory","$ionicPopup","$translate","MessageService","LocalDataService","OrganizationService",function(e,n,t,o,a,i,r,s,l,c,u,d){o.info("init messages controller"),e.$on("$ionicView.enter",function(){n.reloadMessages&&e.load()}),e.messages=[],e.userID=u.loadUser().id,e.load=function(){i.show({template:l.instant("MESSAGES.LOADING_LIST")});var t=a.orgID;c.getMessagesByUser(e.userID,t).then(function(t){e.messages=t,n.reloadMessages=!1,i.hide(),e.$broadcast("scroll.refreshComplete")},function(e){o.error("failed to load messages history",e),s.alert({title:l.instant("MESSAGES.LOAD_FAILED"),template:e})})},e.load(),e.selectMessage=function(e){t.go("app.messagedetails",{messageID:e.id})}}]);var controllers=angular.module("App.controllers");controllers.controller("MessageCtrl",["$scope","$rootScope","$state","$filter","$log","$stateParams","$ionicLoading","$ionicHistory","$ionicActionSheet","$ionicModal","$templateCache","$ionicPopup","$translate","MessageService","LocalDataService","DocumentService",function(e,n,t,o,a,i,r,s,l,c,u,d,p,g,m,v){a.info("init messages controller"),e.isLoading=!1,e.$on("$ionicView.beforeEnter",function(){i.messageID&&e.loadMessage()}),e.$on("$ionicView.beforeLeave",function(){n.supportMessage={}}),e.userID=m.loadUser().id,e.currentMessage={},e.currentAttachments=[],e.loadMessage=function(){r.show({template:p.instant("MESSAGES.LOADING")}),e.isLoading=!0;var t=i.messageID;g.getMessageDetails(t).then(function(i){r.hide(),e.isLoading=!1,a.info("loaded message",i),e.currentMessage=i[0],e.messageOptions=[],e.getSelectedRoutingPath(e.currentMessage.PreviousRoutingID),e.images=m.getPhotos(),e.currentAttachments=o("filter")(e.images,{message:t}),n.supportMessage=e.currentMessage},function(n){r.hide(),e.isLoading=!1,a.error("failed to load message ",n),d.alert({title:p.instant("MESSAGES.LOAD_FAILED"),template:n})})},e.getSelectedRoutingPath=function(n){var t=n[0];t&&(e.messageOptions.push(t),t.children.length>0&&e.getSelectedRoutingPath(t.children))},e.addNote=function(){if(window.cordova){l.show({buttons:[{text:p.instant("MESSAGES.NOTE_BUTTON")},{text:p.instant("MESSAGES.PHOTO_BUTTON")}],titleText:p.instant("MESSAGES.NOTE_TITLE"),cancelText:p.instant("GENERIC.CANCEL"),buttonClicked:function(n){return 0===n?e.openNoteModal():1===n&&e.addImage(),!0}})}else e.openNoteModal()},e.openNoteModal=function(){e.modal=c.fromTemplate(u.get("message-note.html"),{scope:e}),e.modal.show()},e.saveMessageNote=function(){a.info("add message to note"),r.show({template:p.instant("MESSAGES.SAVING")}),g.updateMessageNote(e.currentMessage).then(function(n){r.hide(),e.messageForm.$setPristine(),e.messageForm.$setUntouched(),e.closeModal()},function(e){r.hide(),d.alert({title:p.instant("MESSAGES.SAVING_FAILED"),template:e})})},e.addImage=function(){r.show({template:p.instant("ATTACHMENT.LOADING")}),v.capturePicture().then(function(n){e.fileURI=n,e.showAttachmentModal(),r.hide()},function(e){r.hide(),d.alert({title:p.instant("ATTACHMENT.SAVING_FAILED"),template:err})})},e.closeModal=function(){a.debug("close modal"),e.modal.hide(),e.modal.remove()},e.showAttachmentModal=function(){e.modal=c.fromTemplate(u.get("new-document.html"),{scope:e}),e.modal.show()},e.closeAttachmentModal=function(n){for(var t in e.images){var o=e.images[t].name,i=o.substring(0,o.length-4);if(n===i)return void d.alert({title:p.instant("ATTACHMENT.FILENAME_NOT_UNIQUE")})}var s=e.currentMessage.id;v.moveFile(e.fileURI,n,s).then(function(t){r.hide(),d.alert({title:p.instant("ATTACHMENT.SAVE_SUCCESS")}),e.currentAttachments.push({name:n+".jpg",url:t}),a.info("document saved: "+n),e.closeModal()},function(e){r.hide(),d.alert({title:p.instant("ATTACHMENT.SAVE_FAILED"),template:e})})},e.selectDocument=function(n){e.document=n,e.showModal("document-details.html")},e.showModal=function(n){e.modal=c.fromTemplate(u.get(n),{scope:e}),e.modal.show()}}]);var controllers=angular.module("App.controllers");controllers.controller("DocumentCtrl",["$scope","$rootScope","$stateParams","$state","$log","$templateCache","$ionicBackdrop","$ionicModal","$translate","$cordovaCamera","$cordovaFile","$ionicLoading","$ionicPopup","LocalDataService","DocumentService",function(e,n,t,o,a,i,r,s,l,c,u,d,p,g,m){a.debug("init document controller"),e.cameraAvailable=window.cordova,e.images=g.getPhotos(),e.attachment={},e.$on("$ionicView.enter",function(){t.document&&e.load()}),e.load=function(){a.debug("load documents"),e.cameraAvailable&&(e.images=g.getPhotos())},e.urlForImage=function(e){var n=e.substr(e.lastIndexOf("/")+1);cordova.file.dataDirectory+n;return e},e.addImage=function(){d.show({template:l.instant("ATTACHMENT.LOADING")}),m.capturePicture().then(function(n){e.fileURI=n,e.showAttachmentModal(),d.hide()},function(e){d.hide()})},e.selectDocument=function(n){e.document=n,e.showModal("document-details.html")},e.showModal=function(n){e.modal=s.fromTemplate(i.get(n),{scope:e}),e.modal.show()},e.closeModal=function(){a.debug("close modal"),e.modal.hide(),e.modal.remove()},e.showAttachmentModal=function(){e.modal=s.fromTemplate(i.get("new-document.html"),{scope:e}),e.modal.show()},e.closeAttachmentModal=function(){var n=e.attachment.filename;for(var t in e.images){var o=e.images[t].name,i=o.substring(0,o.length-4);if(n===i)return void p.alert({title:l.instant("ATTACHMENT.FILENAME_NOT_UNIQUE")})}m.moveFile(e.fileURI,e.attachment.filename).then(function(n){d.hide(),p.alert({title:l.instant("ATTACHMENT.SAVE_SUCCESS")}),e.closeModal(),e.images=g.getPhotos(),a.info("display images",e.images)},function(e){d.hide(),p.alert({title:l.instant("ATTACHMENT.SAVE_FAILED"),template:err})})}}]);var controllers=angular.module("App.controllers");controllers.controller("FavoritesCtrl",["$scope","$rootScope","$state","$log","$stateParams","$ionicLoading","$ionicHistory","MessageService","LocalDataService","OrganizationService","OptionService",function(e,n,t,o,a,i,r,s,l,c,u){o.info("init favorites controller"),e.organizations=[],e.userID=l.loadUser().id,e.$on("$ionicView.enter",function(){n.reloadFavorites&&e.loadOrgs()}),e.loadOrgs=function(){i.show({template:"Loading..."}),s.getCompaniesWithMsgCount(e.userID).then(function(t){e.organizations=t,n.reloadFavorites=!1,i.hide(),e.$broadcast("scroll.refreshComplete")},function(n){i.hide(),e.$broadcast("scroll.refreshComplete")})},e.loadOrgs(),e.selectOrganisation=function(e){n.sessionData.options=[],u.getOptionsTree(e.OrgID).then(function(a){o.info("loaded org details"),n.organizationDetails=a,n.sessionData.organization=a,t.go("app.options",{orgID:e.OrgID,parentID:0}),i.hide()},function(e){o.error("failed to load org details selected in favorites",e)})}}]);